<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Kansupada-Oberoi Royal Expedition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <!-- Configuration (contains API keys) -->
    <!-- For local development: config.js is loaded -->
    <!-- For GitHub Pages: config.js is injected during deployment -->
    <script src="config.js" onerror="console.warn('config.js not found - will be injected during deployment')"></script>

    <!-- Google Maps JavaScript API (key loaded from config.js) -->
    <script>
        // Dynamically load Google Maps with API key from config
        (function() {
            // Wait a brief moment to ensure config.js loads (if present)
            setTimeout(function() {
                if (typeof CONFIG === 'undefined' || !CONFIG.GOOGLE_MAPS_API_KEY) {
                    console.error('‚ùå Google Maps API key not configured. Map will not load.');
                    const mapDiv = document.getElementById('map');
                    if (mapDiv) {
                        mapDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">‚ö†Ô∏è Map configuration pending. Please check deployment settings.</div>';
                    }
                    return;
                }

                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${CONFIG.GOOGLE_MAPS_API_KEY}&callback=initMap&libraries=places&v=weekly`;
                script.defer = true;
                script.onerror = function() {
                    console.error('‚ùå Failed to load Google Maps API');
                };
                document.head.appendChild(script);
            }, 100);
        })();
    </script>

    <!-- Chosen Palette: Royal Rajasthan -->
    <!-- 
        Primary Background: #FDFBF7 (Warm Sandstone)
        Text: #1F2937 (Charcoal)
        Accent: #9F1239 (Mughal Red) for calls to action/highlights
        Secondary: #B45309 (Marigold/Saffron) for subheaders
        Tertiary: #064E3B (Royal Green) for nature/safari elements
    -->

    <!-- Application Structure Plan: 
         1. Header & Quick Stats: Immediate high-level overview for the VC/Strategist.
         2. Interactive Master Timeline: The core feature. A day-by-day scroller with clear times, locations, and "Vibe" indicators.
         3. The "Export" Utility: A prominent button to download the CSV for Google Sheets import (Requested specifically).
         4. Concierge Details (Tabs): 
            - Dining Ledger: Specific restaurants, cuisines, and dress codes.
            - Logistics & Packing: Flight numbers, outfit advice per location.
         5. Visual Analysis: Charts showing the balance of culture vs. chill to reassure the parents and new GF.
    -->

    <!-- Visualization & Content Choices:
         - Timeline: Vertical flex layout with distinct time blocks. Goal: Clarity on "Where do I need to be?".
         - Charts: Doughnut chart for Activity Balance (Relaxation vs. Travel). Goal: Prove the trip isn't too hectic.
         - Dining Cards: Grid layout. Goal: Show menu vibes and dress codes.
         - Interaction: Vanilla JS filter for "Day View" and CSV Export generation. Also, all URLs are now stable.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Lato', sans-serif;
            background-color: #FDFBF7;
            color: #1F2937;
        }
        h1, h2, h3, .serif-font {
            font-family: 'Playfair Display', serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            height: 250px;
        }
        @media (min-width: 640px) {
            .chart-container {
                height: 300px;
            }
        }
        .timeline-line {
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #E5E7EB;
            z-index: 0;
        }
        .luxury-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .luxury-card:hover {
            transform: translateY(-2px);
            border-left: 4px solid #9F1239; /* Mughal Red */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .restaurant-link {
            color: #9F1239;
        }
        .restaurant-link:hover {
            color: #b91c1c; /* Slightly darker on hover */
        }
        /* Custom scrollbar for timeline */
        .timeline-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .timeline-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .timeline-scroll::-webkit-scrollbar-thumb {
            background: #D1D5DB;
            border-radius: 4px;
        }
        /* Map container */
        #map {
            height: 600px;
            width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        @media (max-width: 640px) {
            #map {
                height: 450px;
            }
        }
        /* Custom Google Maps info window styling */
        .gm-style .gm-style-iw-c {
            border-radius: 8px;
            padding: 12px;
        }
        .gm-style .gm-style-iw-d {
            font-family: 'Lato', sans-serif;
        }

        /* Map Controls Overlay */
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            padding: 8px;
        }
        .map-controls button {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 4px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            text-align: left;
        }
        .map-controls button:last-child {
            margin-bottom: 0;
        }
        .map-controls button.active {
            background: #ec4899;
            color: white;
            border-color: #ec4899;
        }
        .map-controls button:hover:not(.active) {
            background: #f3f4f6;
        }
        .map-controls .dropdown {
            position: relative;
        }
        .map-controls .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 8px;
            min-width: 220px;
            margin-top: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        .map-controls .dropdown-menu.open {
            display: block;
        }
        .map-controls .dropdown-menu label {
            display: flex;
            align-items: center;
            padding: 6px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }
        .map-controls .dropdown-menu label:hover {
            background: #f3f4f6;
            border-radius: 4px;
        }
        .map-controls .dropdown-menu input[type="checkbox"] {
            margin-right: 8px;
        }
        .map-controls .dropdown-menu hr {
            margin: 8px 0;
            border: none;
            border-top: 1px solid #e5e7eb;
        }
        .map-controls .dropdown-menu .action-buttons {
            display: flex;
            gap: 4px;
        }
        .map-controls .dropdown-menu .action-buttons button {
            flex: 1;
            margin: 0;
            padding: 6px;
            font-size: 11px;
            text-align: center;
        }

        /* Boutique Sidebar Cards */
        .boutique-card {
            transition: all 0.2s;
            cursor: pointer;
        }
        .boutique-card:hover {
            background: #fef3f2;
        }
        .boutique-card.highlighted {
            background: #dbeafe;
            border-left: 3px solid #2563eb;
            padding-left: 3px;
        }
        .boutique-card a {
            text-decoration: none;
        }
        .boutique-card a:hover {
            text-decoration: underline;
        }

        /* Responsive map controls */
        @media (max-width: 640px) {
            .map-controls {
                top: 5px;
                right: 5px;
                padding: 6px;
            }
            .map-controls button {
                padding: 6px 10px;
                font-size: 12px;
            }
            .map-controls .dropdown-menu {
                min-width: 200px;
            }
        }

        /* Restaurant Selection Styles */
        .restaurant-choice-toggle {
            margin-top: 0.75rem;
        }
        .restaurant-choice-toggle button {
            width: 100%;
            padding: 0.75rem 1rem;
            background-color: #FEF3C7; /* Amber 100 */
            border: 1px solid #FCD34D; /* Amber 300 */
            border-radius: 0.5rem;
            font-weight: 500;
            color: #78350F; /* Amber 900 */
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .restaurant-choice-toggle button:hover {
            background-color: #FDE68A; /* Amber 200 */
        }
        .restaurant-options-container {
            margin-top: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .restaurant-option-card {
            padding: 1rem;
            border: 2px solid #E5E7EB; /* Gray 200 */
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .restaurant-option-card:hover {
            border-color: #FB923C; /* Amber 400 */
            background-color: #FFFBEB; /* Amber 50 */
        }
        .restaurant-option-card.selected {
            border-color: #9F1239; /* Mughal Red */
            background-color: #FEF2F2; /* Rose 50 */
        }
        .cuisine-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background-color: #FEF3C7; /* Amber 100 */
            color: #92400E; /* Amber 800 */
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }
        .restaurant-highlights {
            font-size: 0.75rem;
            color: #6B7280; /* Gray 500 */
            margin-top: 0.5rem;
        }
        .restaurant-highlights span {
            margin-right: 0.5rem;
        }
        .selected-restaurant {
            padding: 0.75rem;
            background-color: #FEF2F2; /* Rose 50 */
            border-left: 4px solid #9F1239; /* Mughal Red */
            border-radius: 0.5rem;
            margin-top: 0.5rem;
        }
        .selected-restaurant h4 {
            color: #881337; /* Rose 900 */
        }
        .all-inclusive-badge {
            padding: 0.75rem;
            background-color: #ECFDF5; /* Green 50 */
            border: 1px solid #A7F3D0; /* Green 200 */
            border-radius: 0.5rem;
            margin-top: 0.5rem;
        }
        .all-inclusive-badge-header {
            display: flex;
            align-items: center;
            color: #065F46; /* Green 800 */
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        .all-inclusive-badge-text {
            color: #047857; /* Green 700 */
            font-size: 0.75rem;
        }
        /* Animation */
        .slide-down {
            animation: slideDown 0.3s ease-out forwards;
        }
        @keyframes slideDown {
            from {
                max-height: 0;
                opacity: 0;
            }
            to {
                max-height: 1000px;
                opacity: 1;
            }
        }
        /* Toast notification */
        .toast-notification {
            position: fixed;
            top: 5rem;
            right: 1rem;
            background-color: #10B981; /* Green 500 */
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            font-weight: 600;
            animation: slideInRight 0.3s ease-out;
        }
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Navigation / Hero -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center">
                    <span class="text-3xl text-rose-800 mr-3">‚öúÔ∏è</span>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 serif-font tracking-wide">The Royal Expedition</h1>
                        <p class="text-xs text-gray-500 uppercase tracking-widest">Dec 17 - 25, 2025 ‚Ä¢ The Oberoi Circuit</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="fashion.html" class="hidden md:flex items-center bg-rose-700 hover:bg-rose-800 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors shadow-sm">
                        <span>üëó Fashion Guide</span>
                    </a>
                    <a href="feedback.html" class="hidden md:flex items-center bg-purple-700 hover:bg-purple-800 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors shadow-sm">
                        <span>üí≠ Suggest Changes</span>
                    </a>
                    <div class="text-right hidden sm:block">
                        <div class="text-sm font-bold text-gray-900">10 Travelers</div>
                        <div class="text-xs text-gray-500">Zane's 3rd Birthday</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <!-- INTRO CONTEXT -->
        <div class="mb-8 bg-white p-6 rounded-lg shadow-sm border border-gray-100">
            <h2 class="text-xl font-bold serif-font text-gray-800 mb-2">üéØ Trip Command Center</h2>
            <p class="text-gray-600 leading-relaxed mb-3">
                <strong>UPDATED with all confirmed Mitesh reservations.</strong> This interface consolidates the complete logistics for the Kansupada Family Oberoi circuit (Dec 17-25, 2025).
                All dining entries include direct restaurant URLs, dress codes, and confirmed booking details from WhatsApp/email confirmations.
            </p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                <div class="bg-rose-50 p-3 rounded">
                    <div class="font-bold text-rose-900">10 Travelers</div>
                    <div class="text-rose-600 text-xs">2 Adults, 8 Family</div>
                </div>
                <div class="bg-amber-50 p-3 rounded">
                    <div class="font-bold text-amber-900">4 Hotels</div>
                    <div class="text-amber-600 text-xs">All Oberoi Properties</div>
                </div>
                <div class="bg-blue-50 p-3 rounded">
                    <div class="font-bold text-blue-900">9 Days</div>
                    <div class="text-blue-600 text-xs">Dec 17 - Dec 25</div>
                </div>
                <div class="bg-green-50 p-3 rounded">
                    <div class="font-bold text-green-900">üéÇ Birthday!</div>
                    <div class="text-green-600 text-xs">Zane turns 3 on Dec 24</div>
                </div>
            </div>
        </div>

        <!-- INTERACTIVE MAP -->
        <div class="mb-8 bg-white p-6 rounded-lg shadow-sm border border-gray-100">
            <h2 class="text-xl font-bold serif-font text-gray-800 mb-2">üó∫Ô∏è Interactive Journey Map</h2>
            <p class="text-gray-600 text-sm mb-4">Complete itinerary with all restaurants, attractions, and activities. Click markers for details!</p>
            <div style="position: relative;">
                <div id="map"></div>

                <!-- Map Controls Overlay -->
                <div class="map-controls">
                    <div class="dropdown">
                        <button id="shopping-toggle" class="active">üõçÔ∏è Shopping</button>
                        <div class="dropdown-menu" id="shopping-dropdown">
                            <label>
                                <input type="checkbox" checked data-category="jewelry"> üíç Jewelry <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="fashion"> üëó Fashion <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="menswear"> üëî Menswear <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="home"> ü™¥ Home Decor <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="perfume"> üå∏ Perfume <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="shopping"> üè™ Markets <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="handicrafts"> üé® Handicrafts <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="accessories"> üëú Accessories <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="lifestyle"> ‚ú® Lifestyle <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="luxury"> üíé Luxury <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="textile"> üßµ Textiles <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="museum"> üèõÔ∏è Museums <span class="count">(0)</span>
                            </label>
                            <label>
                                <input type="checkbox" checked data-category="souvenirs"> üéÅ Souvenirs <span class="count">(0)</span>
                            </label>
                            <hr>
                            <div class="action-buttons">
                                <button id="show-all-shopping">Show All</button>
                                <button id="hide-all-shopping">Hide All</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-4 grid grid-cols-2 md:grid-cols-5 gap-3 text-xs">
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-emerald-600 rounded-full mr-2"></div>
                    <span class="text-gray-700">Start/End: Mumbai</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-red-600 rounded-full mr-2"></div>
                    <span class="text-gray-700">Day 1-2: Udaipur</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-blue-600 rounded-full mr-2"></div>
                    <span class="text-gray-700">Day 3-4: Agra</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-green-600 rounded-full mr-2"></div>
                    <span class="text-gray-700">Day 4-6: Ranthambore</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-purple-600 rounded-full mr-2"></div>
                    <span class="text-gray-700">Day 6-9: Jaipur</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- LEFT COLUMN: Interactive Timeline (The "Annoying Brother" View) -->
            <div class="lg:col-span-2 space-y-6">
                <div class="flex justify-between items-end mb-2">
                    <h2 class="text-2xl font-bold serif-font text-gray-900">Day-by-Day Protocol</h2>
                    <div class="flex space-x-2 text-sm">
                        <button onclick="filterTimeline('all')" class="px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-medium active-filter" id="btn-all">All</button>
                        <button onclick="filterTimeline('logistics')" class="px-3 py-2 bg-white border border-gray-300 hover:bg-gray-50 rounded text-gray-600" id="btn-logistics">Logistics</button>
                        <button onclick="filterTimeline('dining')" class="px-3 py-2 bg-white border border-gray-300 hover:bg-gray-50 rounded text-gray-600" id="btn-dining">Dining</button>
                    </div>
                </div>

                <!-- Timeline Container -->
                <div id="timeline-container" class="space-y-8 relative">
                    <!-- JS will populate this -->
                </div>
            </div>

            <!-- RIGHT COLUMN: Analytics, Concierge & Dining (The "Strategist/Parent" View) -->
            <div class="lg:col-span-1 space-y-8">
                
                <!-- Trip Balance Chart -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold serif-font text-gray-900 mb-4">Pace Analysis</h3>
                    <p class="text-sm text-gray-500 mb-4">Balancing the "Go-Go-Go" vs. "Just Chill."</p>
                    <div class="chart-container flex justify-center">
                        <canvas id="balanceChart"></canvas>
                    </div>
                </div>

                <!-- Shopping in City Sidebar -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100" id="shopping-sidebar">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold serif-font text-gray-900">
                            üõçÔ∏è Shopping in <span id="shopping-city-name">Udaipur</span>
                        </h3>
                        <span class="text-xs text-gray-500" id="shopping-count">0 boutiques</span>
                    </div>
                    <div class="space-y-3" id="shopping-sidebar-list">
                        <!-- Populated by JS -->
                    </div>
                    <a href="shopping.html" id="shopping-view-all" class="block mt-4 text-sm text-rose-700 font-semibold hover:text-rose-800">
                        View All Shopping ‚Üí
                    </a>
                </div>

                <!-- Dining Highlights -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold serif-font text-gray-900 mb-4">Gastronomy & Dress Code</h3>
                    <div class="space-y-4" id="dining-list">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Logistics Card -->
                <div class="bg-amber-50 p-6 rounded-xl border border-amber-100">
                    <h3 class="text-lg font-bold serif-font text-amber-900 mb-2">üöô Logistics Brief</h3>
                    <ul class="space-y-3 text-sm text-amber-900">
                        <li class="flex items-start">
                            <span class="mr-2">‚úàÔ∏è</span>
                            <span><strong>Dec 17 BOM‚ÜíUDR:</strong> AI 2579, 10 pax confirmed. Airport pickup arranged.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">‚úàÔ∏è</span>
                            <span><strong>Dec 19 UDR‚ÜíDEL:</strong> Flight confirmed (Pre-Agra drive)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">‚úàÔ∏è</span>
                            <span><strong>Dec 25 JAI‚ÜíBOM:</strong> 7:55 PM flight. Airport transfer at 5:30 PM.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">üöô</span>
                            <span><strong>Vehicle:</strong> Luxury van/coach from Mitesh (similar to Urbania/Tempo Traveller). White with comfortable seating, baggage space. Car seat requested.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">üë®‚Äçüè´</span>
                            <span><strong>Guides:</strong> English-speaking, government-approved guides booked by Mitesh for Udaipur (Day 2) and Delhi-Jaipur segment. Kid-friendly storytellers requested.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">üëó</span>
                            <span><strong>Packing:</strong> Layers essential! Mornings in Ranthambore are COLD (5¬∞C/40¬∞F). Afternoons in Jaipur are sunny (24¬∞C/75¬∞F). Dress codes range from Casual to Resort Elegant.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">üçº</span>
                            <span><strong>Zane (age 3):</strong> High chairs confirmed at all restaurant bookings. NOTE: Request 5:30 PM daily snacks from hotel concierge.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900 text-white py-12 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="serif-font text-xl mb-4">The Oberoi Experience</p>
            <p class="text-gray-400 text-sm">Curated for the Kansupada Family ‚Ä¢ Dec 2025</p>
        </div>
    </footer>

    <script>
        // --- DATA STORE ---
        // Official Oberoi hotel URLs
        const OBEROI_UDAIVILAS_URL = "https://www.oberoihotels.com/hotels-in-udaipur-udaivilas-resort/";
        const OBEROI_AMARVILAS_URL = "https://www.oberoihotels.com/hotels-in-agra-amarvilas-resort/";
        const OBEROI_VANYAVILAS_URL = "https://www.oberoihotels.com/hotels-in-ranthambhore-vanyavilas-resort/";
        const OBEROI_RAJVILAS_URL = "https://www.oberoihotels.com/hotels-in-jaipur-rajvilas-resort/";
        
        const tripData = [
            {
                day: "Day 1",
                date: "Wed, Dec 17",
                location: "Udaipur",
                hotel: "Oberoi Udaivilas",
                temp: "59-77¬∞F",
                events: [
                    { time: "10:30 AM", title: "‚úàÔ∏è Flight: AI 2579 BOM‚ÜíUDR", type: "logistics", detail: "Air India 2579. Mumbai (BOM) to Udaipur (UDR). PNR: DJM9L3. 10 Passengers. Arrival: 12:00 PM." },
                    { time: "12:00 PM", title: "Airport Pickup", type: "logistics", detail: "10 people. Transfer to Oberoi Udaivilas." },
                    { time: "02:30 PM", title: "Early Check-in: Oberoi Udaivilas", type: "logistics", detail: "Rooms ready by 2:30-3:00 PM. Welcome ceremony. NOTE: Request 5:30 PM daily snacks for Zane from concierge." },
                    { time: "05:00 PM", title: "Sunset Boat Ride", type: "culture", detail: "Private boat from hotel dock to Lake Pichola. Boat transfer to Taj Lake Palace for dinner." },
                    { time: "06:00 PM", title: "Dinner: Taj Lake Palace", type: "dining", detail: "‚Çπ10,500 per person cover charge. Boat access from hotel. *Smart Casual to Elegant.* High chair confirmed.", url: "https://www.tajhotels.com/en-in/taj/taj-lake-palace-udaipur/dining/" }
                ]
            },
            {
                day: "Day 2",
                date: "Thu, Dec 18",
                location: "Udaipur",
                hotel: "Oberoi Udaivilas",
                temp: "59-77¬∞F",
                events: [
                    { time: "08:00 AM", title: "Breakfast at Hotel", type: "dining", detail: "Buffet & A la carte. Leisurely morning.", url: OBEROI_UDAIVILAS_URL },
                    { time: "10:00 AM", title: "City Palace Tour", type: "culture", detail: "Government-approved guide, good with kids (ages 3 & 9). Booked by Mitesh. NOTE: Request 5:30 PM snack for Zane from concierge." },
                    { time: "12:30 PM", title: "Lunch: Ambrai Restaurant", type: "dining", detail: "Lakeside seating with City Palace views. 10 people, high chair. *Casual to Smart Casual.*", url: "https://www.ambrai.com/" },
                    { time: "04:00 PM", title: "Miniature Painting Workshop", type: "culture", detail: "Shyam Arts (complimentary via hotel)." },
                    { time: "05:00 PM", title: "Glass Inlay Art (Thekri)", type: "culture", detail: "Traditional craft workshop (complimentary via hotel)." },
                    {
                        time: "06:00 PM",
                        title: "Dinner: Chandni",
                        type: "dining",
                        detail: "High chair confirmed. *Smart Casual.*",
                        url: OBEROI_UDAIVILAS_URL,
                        restaurantInfo: {
                            name: "Chandni",
                            cuisine: "Pan-Asian",
                            description: "Lakeside restaurant featuring Pan-Asian cuisine with Lake Pichola views. Specializes in sushi, dim sum, and Thai dishes.",
                            dressCode: "Smart Casual",
                            highlights: ["Lakeside seating", "Sushi bar", "Thai specialties", "Vegetarian options"]
                        }
                    }
                ]
            },
            {
                day: "Day 3",
                date: "Fri, Dec 19",
                location: "Udaipur ‚Üí Agra",
                hotel: "Oberoi Udaivilas ‚Üí Oberoi Amarvilas",
                temp: "50-72¬∞F",
                events: [
                    { time: "08:00 AM", title: "Breakfast at Hotel (Included)", type: "dining", detail: "Buffet & A la carte. All breakfasts included in hotel reservation.", url: OBEROI_UDAIVILAS_URL },
                    { time: "09:00 AM", title: "Depart for Airport", type: "logistics", detail: "Transfer to UDR Airport. Government-approved guide from Mitesh." },
                    { time: "11:00 AM", title: "‚úàÔ∏è Flight: UDR‚ÜíDEL", type: "logistics", detail: "Udaipur (UDR) to Delhi (DEL). IndiGo or Air India (Confirmed). Flight details TBD." },
                    { time: "12:00 PM", title: "Lunch Stop in Delhi", type: "dining", detail: "Family-friendly restaurant en route. TBD with Mitesh recommendations." },
                    { time: "01:30 PM", title: "Drive: DEL to Agra", type: "logistics", detail: "Yamuna Expressway (~3.5 hours). One vehicle from Mitesh." },
                    { time: "05:00 PM", title: "Check-in: Amarvilas", type: "logistics", detail: "Rooms ready by 5:00 PM. All rooms have Taj Mahal views. NOTE: Request 5:30 PM snack for Zane from concierge." },
                    {
                        time: "06:00 PM",
                        title: "Dinner at Hotel",
                        type: "dining",
                        detail: "Choose your preferred restaurant. High chair confirmed. *Smart Casual.*",
                        url: OBEROI_AMARVILAS_URL,
                        hasMultipleOptions: true,
                        restaurantOptions: [
                            {
                                id: "daawat-e-nawab",
                                name: "Daawat-E-Nawab",
                                cuisine: "Mughlai & North Indian",
                                description: "Traditional Mughlai cuisine with royal recipes. Known for kebabs, biryanis, and rich curries.",
                                dressCode: "Smart Casual",
                                highlights: ["Authentic Mughlai", "Royal recipes", "Kebab specialties"]
                            },
                            {
                                id: "pinch-of-spice",
                                name: "Pinch of Spice",
                                cuisine: "Contemporary Indian",
                                description: "Modern Indian cuisine with creative presentations. Popular family-friendly restaurant.",
                                dressCode: "Casual to Smart Casual",
                                highlights: ["Contemporary style", "Kid-friendly", "Creative menu"]
                            },
                            {
                                id: "taj-bano",
                                name: "Taj Bano",
                                cuisine: "Mughlai",
                                description: "Classic Mughlai restaurant offering traditional dishes in an elegant setting.",
                                dressCode: "Smart Casual",
                                highlights: ["Traditional recipes", "Elegant ambiance", "Local favorite"]
                            },
                            {
                                id: "tease-me",
                                name: "Tea'se Me",
                                cuisine: "Multi-Cuisine Caf√©",
                                description: "Casual caf√©-style dining with diverse menu options including Western favorites.",
                                dressCode: "Casual",
                                highlights: ["Western options", "Casual atmosphere", "Family-friendly"]
                            },
                            {
                                id: "peshawri",
                                name: "Peshawri",
                                cuisine: "Northwest Frontier",
                                description: "Renowned restaurant specializing in robust Northwest Frontier cuisine cooked in clay ovens.",
                                dressCode: "Smart Casual to Elegant",
                                highlights: ["Tandoor specialties", "Premium dining", "Award-winning"]
                            },
                            {
                                id: "qairo",
                                name: "Qairo",
                                cuisine: "Mediterranean & Middle Eastern",
                                description: "Mediterranean and Middle Eastern cuisine with fresh ingredients and aromatic flavors.",
                                dressCode: "Smart Casual",
                                highlights: ["Mediterranean", "Fresh ingredients", "Unique flavors"]
                            }
                        ]
                    }
                ]
            },
            {
                day: "Day 4",
                date: "Sat, Dec 20",
                location: "Agra ‚Üí Ranthambore",
                hotel: "Oberoi Amarvilas ‚Üí Oberoi Vanyavilas",
                temp: "46-68¬∞F",
                events: [
                    { time: "06:00 AM", title: "Kids Breakfast Boxes", type: "dining", detail: "Ready by 6:00 AM (2 boxes for ages 3 & 9). Request from hotel concierge." },
                    { time: "06:15 AM", title: "Sunrise Taj Mahal Tour", type: "culture", detail: "Private guide good with kids. Golf cart transfer. *Saturday visit - Taj Mahal is OPEN*" },
                    { time: "09:30 AM", title: "Breakfast at Hotel (Included)", type: "dining", detail: "Return to hotel after Taj visit. Buffet included in reservation.", url: OBEROI_AMARVILAS_URL },
                    { time: "11:00 AM", title: "Drive to Ranthambore", type: "logistics", detail: "~5 hours drive from Agra to Ranthambore. Fatehpur Sikri - ask Mitesh if worth it with kids." },
                    { time: "01:00 PM", title: "Packed Lunch En Route", type: "dining", detail: "Packed lunches from Oberoi Amarvilas (hotel said no restaurant recommendations available). Request packed lunch boxes for 10 people from hotel." },
                    { time: "05:00 PM", title: "Check-in: Vanyavilas", type: "logistics", detail: "Luxury Tents. Early arrival, rooms ready. NOTE: Request 5:30 PM snack for Zane from concierge." },
                    {
                        time: "06:00 PM",
                        title: "Dinner at Hotel (All-Inclusive)",
                        type: "dining",
                        detail: "High chair available. *Casual Resort Wear.*",
                        url: OBEROI_VANYAVILAS_URL,
                        allInclusive: true,
                        restaurantInfo: {
                            note: "All meals included at Vanyavilas. Hotel assigns dining locations based on availability."
                        }
                    }
                ]
            },
            {
                day: "Day 5",
                date: "Sun, Dec 21",
                location: "Ranthambore",
                hotel: "Oberoi Vanyavilas",
                temp: "41-72¬∞F",
                events: [
                    { time: "06:30 AM", title: "Kids Breakfast Boxes", type: "dining", detail: "Ready by 6:30 AM (2 boxes for kids). Request from hotel concierge." },
                    { time: "07:00 AM", title: "Tiger Safari", type: "culture", detail: "10 people. REQUESTED Zones 1/2/3 (better tiger sightings). Private gypsies preferred. Confirm zone & vehicle. *DRESS WARM - 5¬∞C/40¬∞F morning temps!*" },
                    { time: "12:00 PM", title: "Lunch at Hotel (Included)", type: "dining", detail: "All meals included in Vanyavilas stay. High chair available.", url: OBEROI_VANYAVILAS_URL },
                    { time: "02:00 PM", title: "Spa Treatments", type: "leisure", detail: "Spa treatments for all 8 adults, 2:00-4:30 PM post-safari relaxation. Booking in progress." },
                    { time: "04:00 PM", title: "Block Printing for Kids", type: "culture", detail: "If hotel can arrange. Check with concierge. NOTE: Request 5:30 PM snack for Zane." },
                    { time: "Evening", title: "Optional Activities", type: "leisure", detail: "Stargazing (if hotel offers) OR Camel cart ride (if available)." },
                    {
                        time: "06:00 PM",
                        title: "Dinner at Hotel (All-Inclusive)",
                        type: "dining",
                        detail: "Regular restaurant OR bush dinner (ask hotel for best option). High chair available. *Casual Resort Wear.*",
                        url: OBEROI_VANYAVILAS_URL,
                        allInclusive: true,
                        restaurantInfo: {
                            note: "All meals included at Vanyavilas. Hotel assigns dining locations based on availability."
                        }
                    }
                ]
            },
            {
                day: "Day 6",
                date: "Mon, Dec 22",
                location: "Ranthambore ‚Üí Jaipur",
                hotel: "Oberoi Vanyavilas ‚Üí Oberoi Rajvilas",
                temp: "50-75¬∞F",
                events: [
                    { time: "08:00 AM", title: "Breakfast at Hotel (Included)", type: "dining", detail: "All meals included at Vanyavilas. Buffet & A la carte.", url: OBEROI_VANYAVILAS_URL },
                    { time: "09:00 AM", title: "Checkout", type: "logistics", detail: "Depart Vanyavilas for Jaipur." },
                    { time: "10:00 AM", title: "Morning Activity (Optional)", type: "culture", detail: "Village walk OR Ranthambore Fort - ask hotel which is better for kids with ages 3 & 9." },
                    { time: "10:30 AM", title: "Drive to Jaipur", type: "logistics", detail: "~3.5 hours. Packed lunch OR lunch en route." },
                    { time: "02:00 PM", title: "Check-in: Rajvilas", type: "logistics", detail: "Garden/Pool Villas. NOTE: Request 5:30 PM daily snack for Zane from concierge." },
                    { time: "03:00 PM", title: "Leisure Time", type: "leisure", detail: "Pool & relaxation. Recover from drive." },
                    { time: "06:00 PM", title: "Dinner: Giardino at Jai Mahal Palace", type: "dining", detail: "CONFIRMED. 10 people, 1 high chair. Near Rambagh Palace (Taj Hotel). *Smart Casual.*", url: "https://www.tajhotels.com/en-in/jai-mahal-palace-jaipur/restaurants/giardino/" }
                ]
            },
            {
                day: "Day 7",
                date: "Tue, Dec 23",
                location: "Jaipur",
                hotel: "Oberoi Rajvilas",
                temp: "50-75¬∞F",
                events: [
                    { time: "08:30 AM", title: "Breakfast at Hotel (Included)", type: "dining", detail: "Fuel up for Amber Fort! Buffet & A la carte included in reservation.", url: OBEROI_RAJVILAS_URL },
                    { time: "09:30 AM", title: "Amber Fort Tour", type: "culture", detail: "Jeep ascent. Private guide good with kids. Government-approved guide from Mitesh. *Casual clothes, comfortable shoes.*" },
                    { time: "12:00 PM", title: "Return to Rajvilas", type: "logistics", detail: "Return to hotel for rest before lunch." },
                    { time: "01:00 PM", title: "Transfer to Rambagh Palace", type: "logistics", detail: "~30 min drive from hotel." },
                    { time: "01:30 PM", title: "Lunch: The Verandah at Rambagh Palace", type: "dining", detail: "CONFIRMED. 10 people, 1 high chair. ‚Çπ3,500+ per person minimum. If not available: Rajput Room or Marble Arch as backup. *Smart Casual to Resort Elegant.*", url: "https://www.tajhotels.com/en-in/taj/rambagh-palace-jaipur/restaurants/the-verandah/" },
                    { time: "03:00 PM", title: "Afternoon Leisure at Rajvilas", type: "leisure", detail: "Complete relaxation after fort tour. Pool time. NO activities planned. NOTE: Request 5:30 PM snack for Zane from concierge." },
                    { time: "06:00 PM", title: "Dinner: Wink at The Lalit Jaipur", type: "dining", detail: "CONFIRMED. 10 people, 1 high chair. Contemporary dining. *Smart Casual.*", url: "https://www.thelalit.com/the-lalit-jaipur/restaurants-bars/wink/" }
                ]
            },
            {
                day: "Day 8",
                date: "Wed, Dec 24",
                location: "Jaipur - ZANE'S 3RD BIRTHDAY! üéÇüêò",
                hotel: "Oberoi Rajvilas",
                temp: "50-75¬∞F",
                events: [
                    { time: "Morning", title: "ELEPHANT-THEMED Birthday Room", type: "leisure", detail: "Wake up to ELEPHANT-THEMED birthday room setup with balloons/banner (Dec 23-24 overnight decoration)." },
                    { time: "08:00 AM", title: "Birthday Boy Breakfast (Included)", type: "dining", detail: "Special birthday breakfast! Buffet & A la carte included in reservation.", url: OBEROI_RAJVILAS_URL },
                    { time: "09:30 AM", title: "üêò Elefantastic Experience", type: "culture", detail: "ALL 10 people. Elephant interaction, feeding, painting. THE BIRTHDAY ANCHOR EXPERIENCE! *Casual clothes that can get dirty.*", url: "https://www.elefantastic.in/" },
                    { time: "12:00 PM", title: "Return to Rajvilas", type: "logistics", detail: "Return to hotel for rest and birthday activities." },
                    { time: "01:00 PM", title: "Birthday Lunch at Hotel", type: "dining", detail: "Casual birthday lunch at Rajvilas. Included in stay. High chair available.", url: OBEROI_RAJVILAS_URL },
                    { time: "02:00 PM", title: "Birthday Activities at Hotel", type: "leisure", detail: "Private yoga lessons (1 hr), Private chef session (kids+adults, 1 hr), Private pickleball lessons (1 hr), Indian wine tasting (adults only, 1 hr), Treasure hunt (Olivia & Zane, elephant theme), Kite flying (whole family). NOTE: Request 5:30 PM special birthday snack from concierge." },
                    { time: "06:00 PM", title: "üéÇ Christmas Eve BIRTHDAY DINNER: Surya Mahal", type: "dining", detail: "CONFIRMED at Rajvilas. PRIVATE garden setup. Festive Christmas Eve Menu ‚Çπ12,000+ per person. 10 people, high chair. Photographer arranged. Lemon/vanilla OR funfetti cake with 'Happy 3rd Birthday Zane' elephant design. *Resort Elegant to Formal.*", url: OBEROI_RAJVILAS_URL }
                ]
            },
            {
                day: "Day 9",
                date: "Thu, Dec 25",
                location: "Jaipur ‚Üí Mumbai/Delhi (Departure)",
                hotel: "Oberoi Rajvilas ‚Üí Airport",
                temp: "50-75¬∞F",
                events: [
                    { time: "09:00 AM", title: "Leisurely Morning", type: "leisure", detail: "Sleep in after birthday festivities!" },
                    { time: "10:00 AM", title: "Breakfast at Hotel (Included)", type: "dining", detail: "Final breakfast in India. Buffet & A la carte included in reservation.", url: OBEROI_RAJVILAS_URL },
                    { time: "11:00 AM", title: "Lunch: Surya Mahal at Rajvilas", type: "dining", detail: "CONFIRMED. 10 people, 1 high chair. Time flexible - confirm before departure. *Casual Resort Wear.*", url: OBEROI_RAJVILAS_URL },
                    { time: "12:00 PM", title: "Late Checkout", type: "logistics", detail: "Arranged until 12:00-1:00 PM. Pack up and prepare for departure." },
                    { time: "05:30 PM", title: "Airport Transfer", type: "logistics", detail: "Pickup at 5:30 PM. Transfer to Jaipur Airport (JAI) for 7:55 PM flight." },
                    { time: "07:55 PM", title: "‚úàÔ∏è Flight Departure: JAI‚ÜíBOM/DEL", type: "logistics", detail: "Jaipur (JAI) to Mumbai (BOM) or Delhi (DEL). Flight details TBD. 10 passengers." }
                ]
            }
        ];

        // Dining specific data for side panel - UPDATED WITH CONFIRMED RESERVATIONS
        const diningHighlights = [
            { name: "Taj Lake Palace", loc: "Udaipur", note: "Boat Access", dress: "Smart Casual to Elegant", url: "https://www.tajhotels.com/en-in/taj/taj-lake-palace-udaipur/dining/" },
            { name: "Ambrai", loc: "Udaipur", note: "Lakeside ‚Ä¢ City Palace Views", dress: "Casual to Smart Casual", url: "https://www.ambrai.com/" },
            { name: "Chandni", loc: "Udaivilas, Udaipur", note: "Dec 18 Dinner ‚Ä¢ Pan-Asian", dress: "Smart Casual", url: OBEROI_UDAIVILAS_URL },
            { name: "Giardino", loc: "Jai Mahal Palace, Jaipur", note: "Dec 22 Dinner", dress: "Smart Casual", url: "https://www.tajhotels.com/en-in/jai-mahal-palace-jaipur/restaurants/giardino/" },
            { name: "The Verandah", loc: "Rambagh Palace, Jaipur", note: "Dec 23 Lunch", dress: "Smart Casual to Elegant", url: "https://www.tajhotels.com/en-in/taj/rambagh-palace-jaipur/restaurants/the-verandah/" },
            { name: "Wink", loc: "The Lalit Jaipur", note: "Dec 23 Dinner ‚Ä¢ Contemporary", dress: "Smart Casual", url: "https://www.thelalit.com/the-lalit-jaipur/restaurants-bars/wink/" },
            { name: "Marble Arch / Steam", loc: "Rambagh Palace, Jaipur", note: "Dec 24 Birthday Lunch ‚Ä¢ Pizza", dress: "Casual Festive", url: "https://www.tajhotels.com/en-in/taj/rambagh-palace-jaipur/restaurants/" },
            { name: "Surya Mahal", loc: "Rajvilas, Jaipur", note: "Dec 24 Birthday Dinner ‚Ä¢ Festive Menu", dress: "Resort Elegant to Formal", url: OBEROI_RAJVILAS_URL }
        ];

        // Boutiques data - complete list for all trip cities
        const boutiquesData = [
            // MUMBAI
            { name: 'Lune', city: 'Mumbai', position: { lat: 19.0596, lng: 72.8295 }, type: 'jewelry', category: 'Jewelry', icon: 'üíç', color: '#8b5cf6', details: 'Cult jewelry, celestial designs ‚Ä¢ Hours: Mon-Sat 11am‚Äì7:30pm, Sun closed ‚Ä¢ üìç Shop 1 & 2, Labbaik House, 39, Chimbai Road, Bandra West, 400050', url: "shoplune.com" },
            { name: 'Two Extra Lives', city: 'Mumbai', position: { lat: 19.0596, lng: 72.8295 }, type: 'fashion', category: 'Vintage/Concept', icon: 'üëó', color: '#ec4899', details: 'Upcycled, vintage, conscious fashion ‚Ä¢ Hours: Daily 11am‚Äì8pm ‚Ä¢ üìç Bungalow 111, 562 Dr Ambedkar Road, Pali Village, Bandra West, 400050', url: "twoextralives.com" },
            { name: 'Call of the Valley', city: 'Mumbai', position: { lat: 19.0596, lng: 72.8295 }, type: 'perfume', category: 'Perfume/Lifestyle', icon: 'üå∏', color: '#a855f7', details: 'Artisanal Indian perfume oils ‚Ä¢ üìç Shop 3, Aruna Niwas, Pali Village, Bandra West, 400050', url: "callofthevalley.com" },
            { name: 'Good Earth', city: 'Mumbai', position: { lat: 19.0008, lng: 72.8304 }, type: 'home', category: 'Home/Lifestyle', icon: 'ü™¥', color: '#10b981', details: 'Handcrafted luxury homeware, Indian crafts ‚Ä¢ üìç 11-12 Raghuvanshi Mills Compound, Senapati Bapat Marg, Lower Parel', url: "goodearth.in" },
            { name: 'Hatsu', city: 'Mumbai', position: { lat: 19.0008, lng: 72.8304 }, type: 'home', category: 'Home/Design', icon: 'ü™¥', color: '#10b981', details: 'Modern lighting, furniture, quirky d√©cor ‚Ä¢ üìç 25, Laxmi Mill Compound, Shakti Mills Lane, Mahalakshmi', url: "hatsu.in" },
            { name: 'James Ferreira', city: 'Mumbai', position: { lat: 18.951, lng: 72.8144 }, type: 'fashion', category: 'Fashion', icon: 'üëó', color: '#ec4899', details: 'Contemporary clothing from heritage bungalow ‚Ä¢ üìç Studio 47-G Khotachiwadi Trail, 1st Lane, Khotachiwadi, Girgaon', url: "jamesferreira.in" },
            { name: 'Nicobar', city: 'Mumbai', position: { lat: 18.9278, lng: 72.8319 }, type: 'lifestyle', category: 'Lifestyle', icon: '‚ú®', color: '#ec4899', details: 'Tropical-accented homeware, bohemian clothing ‚Ä¢ üìç 10 Ropewalk Lane, Above Kala Ghoda Caf√©, Kala Ghoda, Fort', url: "nicobar.com" },
            { name: 'Ogaan', city: 'Mumbai', position: { lat: 18.9278, lng: 72.8319 }, type: 'fashion', category: 'Designer Fashion', icon: 'üëó', color: '#ec4899', details: 'Indian designer clothing (men\'s and women\'s) ‚Ä¢ üìç 6/8, Navbharat House, Burjorji S Bharucha Marg, Kala Ghoda', url: "ogaan.com" },
            { name: 'Sabyasachi', city: 'Mumbai', position: { lat: 18.932, lng: 72.8347 }, type: 'fashion', category: 'Couture/Wedding', icon: 'üë∞', color: '#f472b6', details: 'Bridalwear flagship/living museum ‚Ä¢ üìç IGP Fort, Veer Nariman Road, near Horniman Circle, Fort', url: "sabyasachiofficial.com" },
            { name: 'Valliyan', city: 'Mumbai', position: { lat: 18.9278, lng: 72.8319 }, type: 'jewelry', category: 'Jewelry', icon: 'üíç', color: '#8b5cf6', details: 'Statement jewelry, retro-futurist designs ‚Ä¢ üìç First Floor, Rhythm House Building, 59 Forbes Street, Fort', url: "valliyan.com" },
            { name: 'Moonray', city: 'Mumbai', position: { lat: 18.9278, lng: 72.8319 }, type: 'fashion', category: 'Womenswear', icon: 'üëó', color: '#ec4899', details: 'Sophisticated tailored womenswear & accessories ‚Ä¢ üìç Ground floor, Mittal Avenue, Kala Ghoda, Fort', url: "moonray.in" },
            { name: 'Jodi', city: 'Mumbai', position: { lat: 18.932, lng: 72.8347 }, type: 'fashion', category: 'Menswear/Womenswear', icon: 'üëó', color: '#ec4899', details: 'Hand-block print, colorful menswear ‚Ä¢ üìç Shop no. 1, Lentin Chambers, Dalal Street, Fort', url: "thejodilife.com" },
            { name: 'Obataimu', city: 'Mumbai', position: { lat: 18.9278, lng: 72.8319 }, type: 'menswear', category: 'Concept/Menswear', icon: 'üëî', color: '#3b82f6', details: 'Limited-edition, innovative contemporary clothing ‚Ä¢ üìç Ground Floor, Machinery House, 3, S Bharucha Marg, Kala Ghoda, Fort', url: "obataimu.com" },
            { name: 'Nappa Dori', city: 'Mumbai', position: { lat: 18.9067, lng: 72.8147 }, type: 'accessories', category: 'Accessories', icon: 'üëú', color: '#f59e0b', details: 'Luggage and leather accessories ‚Ä¢ üìç 2, Sunny House, Mereweather Road, Colaba', url: "nappadori.com" },
            { name: 'Le Mill', city: 'Mumbai', position: { lat: 18.9067, lng: 72.8147 }, type: 'luxury', category: 'Luxury Fashion', icon: 'üíé', color: '#8b5cf6', details: 'Global luxury brands, top international labels ‚Ä¢ üìç 1st Floor, Pheroze Building, Chhatrapati Shivaji Maharaj Marg, Colaba', url: "lemillindia.com" },
            { name: 'Pernia\'s Pop-Up Studio (Bandra)', city: 'Mumbai', position: { lat: 19.0596, lng: 72.8295 }, type: 'menswear', category: 'Designer Menswear', icon: 'üëî', color: '#3b82f6', details: 'Multi-designer luxury menswear ‚Ä¢ üìç Bandra', url: "perniaspopupshop.com" },
            { name: 'Pernia\'s Pop-Up Studio (Juhu)', city: 'Mumbai', position: { lat: 19.099, lng: 72.8268 }, type: 'menswear', category: 'Designer Menswear', icon: 'üëî', color: '#3b82f6', details: 'Multi-designer luxury menswear ‚Ä¢ üìç Juhu', url: "perniaspopupshop.com" },
            { name: 'Raymond', city: 'Mumbai', position: { lat: 19.1355, lng: 72.8262 }, type: 'menswear', category: 'Suiting', icon: 'üëî', color: '#3b82f6', details: 'Classic suits, custom tailoring ‚Ä¢ üìç Andheri West', url: "myraymond.com" },
            { name: 'Curato', city: 'Mumbai', position: { lat: 19.0708, lng: 72.8357 }, type: 'menswear', category: 'Menswear', icon: 'üëî', color: '#3b82f6', details: 'Leading Indian designer brands ‚Ä¢ üìç Khar, Kala Ghoda', url: "curato.in" },
            { name: 'Masculine', city: 'Mumbai', position: { lat: 19.099, lng: 72.8268 }, type: 'menswear', category: 'Tailoring', icon: 'üëî', color: '#3b82f6', details: 'Bespoke tailoring, established 1987 ‚Ä¢ üìç Juhu', url: null },
            { name: 'Abstract Mens', city: 'Mumbai', position: { lat: 19.2307, lng: 72.8567 }, type: 'menswear', category: 'Streetwear', icon: 'üß¢', color: '#6366f1', details: 'Modern oversized, hype street fashion ‚Ä¢ üìç Borivali West', url: null },
            { name: 'Paak Pehnawa', city: 'Mumbai', position: { lat: 19.076, lng: 72.8777 }, type: 'menswear', category: 'Ethnic Menswear', icon: 'üëî', color: '#3b82f6', details: 'Pure, premium ethnicwear for men ‚Ä¢ üìç Mumbai', url: null },
            { name: 'Acros Ethnic', city: 'Mumbai', position: { lat: 19.076, lng: 72.8777 }, type: 'menswear', category: 'Ethnic Menswear', icon: 'üëî', color: '#3b82f6', details: 'Traditional, Indo-western, trending ‚Ä¢ üìç Mumbai', url: null },
            { name: 'Linking Road', city: 'Mumbai', position: { lat: 19.0596, lng: 72.8295 }, type: 'shopping', category: 'Street Shopping', icon: 'üõçÔ∏è', color: '#f59e0b', details: 'Trendy street fashion, accessible prices ‚Ä¢ üìç Bandra West', url: null },
            { name: 'Colaba Causeway', city: 'Mumbai', position: { lat: 18.9067, lng: 72.8147 }, type: 'shopping', category: 'Street Shopping', icon: 'üõçÔ∏è', color: '#f59e0b', details: 'Eclectic finds, vintage-inspired ‚Ä¢ üìç Colaba', url: null },
            { name: 'Oberoi Mall', city: 'Mumbai', position: { lat: 19.1653, lng: 72.8494 }, type: 'shopping', category: 'Mall', icon: 'üè¨', color: '#64748b', details: 'High-street fashion, multi-brand ‚Ä¢ üìç Goregaon', url: null },
            { name: 'Phoenix Palladium', city: 'Mumbai', position: { lat: 19.0008, lng: 72.8304 }, type: 'shopping', category: 'Mall', icon: 'üè¨', color: '#64748b', details: 'Luxury brands, flagship stores ‚Ä¢ üìç Lower Parel', url: null },
            { name: 'R City Mall', city: 'Mumbai', position: { lat: 19.0866, lng: 72.9081 }, type: 'shopping', category: 'Mall', icon: 'üè¨', color: '#64748b', details: 'New brand launches, trendy casuals ‚Ä¢ üìç Ghatkopar West', url: null },
            { name: 'Bhavya Ramesh', city: 'Mumbai', position: { lat: 18.9278, lng: 72.8319 }, type: 'jewelry', category: 'Jewelry', icon: 'üíç', color: '#8b5cf6', details: 'Alternative, edgy, celestial-inspired ‚Ä¢ üìç Kala Ghoda', url: "bhavyaramesh.com" },
            { name: 'ISHARYA', city: 'Mumbai', position: { lat: 19.076, lng: 72.8777 }, type: 'jewelry', category: 'Jewelry', icon: 'üíç', color: '#8b5cf6', details: 'Modern Indian statement jewelry ‚Ä¢ üìç Mumbai', url: "isharya.com" },
            { name: 'Tanzire', city: 'Mumbai', position: { lat: 19.076, lng: 72.8777 }, type: 'jewelry', category: 'Jewelry', icon: 'üíç', color: '#8b5cf6', details: 'Handmade demi-fine jewelry ‚Ä¢ üìç Mumbai', url: "tanzire.com" },
            { name: 'Moksh', city: 'Mumbai', position: { lat: 19.076, lng: 72.8777 }, type: 'jewelry', category: 'Jewelry', icon: 'üíç', color: '#8b5cf6', details: 'Modern, contemporary, luxury jewelry ‚Ä¢ üìç Mumbai', url: "mokshjewellery.com" },
            { name: 'Bodements', city: 'Mumbai', position: { lat: 19.076, lng: 72.8777 }, type: 'fashion', category: 'Fashion/Vintage', icon: 'üëó', color: '#ec4899', details: 'Curated vintage/upcycled clothing ‚Ä¢ üìç Mumbai/Paris', url: "bodements.com" },
            { name: 'Timeless Vintage Studios', city: 'Mumbai', position: { lat: 19.2042, lng: 72.8546 }, type: 'fashion', category: 'Vintage/Thrift', icon: 'üëó', color: '#ec4899', details: 'Thrift, collectibles, vintage, pop-ups ‚Ä¢ üìç Kandivali', url: null },
            { name: 'Teatro Dhora', city: 'Mumbai', position: { lat: 19.0596, lng: 72.8295 }, type: 'lifestyle', category: 'Concept Store', icon: '‚ú®', color: '#ec4899', details: 'Art-fashion, multi-designer, experiential ‚Ä¢ üìç Bandra', url: "teatrodhora.com" },
            { name: 'Yusuf Bhai Perfumery', city: 'Mumbai', position: { lat: 19.076, lng: 72.8777 }, type: 'perfume', category: 'Perfume', icon: 'üå∏', color: '#a855f7', details: 'Heritage Bombay-style perfume ‚Ä¢ üìç Mumbai', url: null },
            { name: 'Boond Fragrances', city: 'Mumbai', position: { lat: 19.076, lng: 72.8777 }, type: 'perfume', category: 'Perfume', icon: 'üå∏', color: '#a855f7', details: 'Pure, natural, artisanal Indian fragrances ‚Ä¢ üìç Mumbai/Kannauj', url: "boondfragrances.com" },
            { name: 'BoConcept India', city: 'Mumbai', position: { lat: 19.0008, lng: 72.8304 }, type: 'home', category: 'Home/Furniture', icon: 'ü™¥', color: '#10b981', details: 'Modern Danish design, premium ‚Ä¢ üìç Lower Parel', url: "boconcept.in" },
            { name: 'The Pure Concept Home', city: 'Mumbai', position: { lat: 18.9278, lng: 72.8319 }, type: 'home', category: 'Home/Interiors', icon: 'ü™¥', color: '#10b981', details: 'Luxe fabrics, home consultancy ‚Ä¢ üìç Kala Ghoda', url: "shop.thepureconcepthome.com" },
            { name: 'Maison Sia', city: 'Mumbai', position: { lat: 19.0008, lng: 72.8304 }, type: 'home', category: 'Home/Decor', icon: 'ü™¥', color: '#10b981', details: 'International, curated luxury ‚Ä¢ üìç Raghuvanshi Mills', url: "maisonsia.com" },

            // JAIPUR
            { name: 'Togs Jaipur', city: 'Jaipur', position: { lat: 26.8871, lng: 75.8076 }, type: 'menswear', category: 'Custom Menswear', icon: 'üëî', color: '#3b82f6', details: 'Designer half jackets to tuxedos, Kurta to Sherwanis ‚Ä¢ üìç B14c, near MFG mall, C Scheme, Ashok Nagar, Jaipur', url: null },
            { name: 'Raymond Jaipur', city: 'Jaipur', position: { lat: 26.8544, lng: 75.8205 }, type: 'menswear', category: 'Suiting', icon: 'üëî', color: '#3b82f6', details: 'Classic suits, custom tailoring ‚Ä¢ üìç Jawaharlal Nehru Marg, Malviya Nagar, Jaipur', url: "myraymond.com" },
            { name: 'Park Avenue Jaipur', city: 'Jaipur', position: { lat: 26.8544, lng: 75.8205 }, type: 'menswear', category: 'Premium Menswear', icon: 'üëî', color: '#3b82f6', details: 'Business suits, formal wear, casual wear ‚Ä¢ üìç Malviya Nagar, Jaipur', url: "parkavenue.in" },
            { name: 'Cityvibes Jaipur', city: 'Jaipur', position: { lat: 26.8544, lng: 75.8205 }, type: 'menswear', category: 'Ethnic Menswear', icon: 'üëî', color: '#3b82f6', details: 'Kurta pajamas, sherwanis, Indo-Western ‚Ä¢ üìç Malviya Nagar, Vaishali Nagar, Jaipur', url: "cityvibes.in" },
            { name: 'ANOKHI', city: 'Jaipur', position: { lat: 26.9024, lng: 75.7878 }, type: 'fashion', category: 'Concept/Fashion', icon: 'üëó', color: '#ec4899', details: 'Block-printed clothing, eco-conscious, 50+ years heritage ‚Ä¢ üìç C-Scheme & Amer, Jaipur', url: "anokhi.com" },
            { name: 'Jaipur Modern', city: 'Jaipur', position: { lat: 26.9124, lng: 75.7873 }, type: 'lifestyle', category: 'Concept Store', icon: '‚ú®', color: '#ec4899', details: 'Contemporary, minimalist locally-made silk & cotton ‚Ä¢ üìç Jaipur', url: null },
            { name: 'Nila House', city: 'Jaipur', position: { lat: 26.9024, lng: 75.7878 }, type: 'textile', category: 'Textile/Lifestyle', icon: 'üßµ', color: '#10b981', details: 'Natural dyeing, modern Rajasthani tradition ‚Ä¢ üìç C-86, Prithviraj Road, C Scheme, Jaipur', url: "nilahouse.com" },
            { name: 'Anokhi Museum', city: 'Jaipur', position: { lat: 26.9855, lng: 75.8513 }, type: 'museum', category: 'Museum/Textile', icon: 'üèõÔ∏è', color: '#6366f1', details: 'Hand-block printing heritage techniques ‚Ä¢ üìç Kheri Gate, Amer, Jaipur', url: "anokhi.com" },
            { name: 'Johri Bazaar', city: 'Jaipur', position: { lat: 26.9248, lng: 75.8246 }, type: 'shopping', category: 'Traditional Market', icon: 'üè™', color: '#ef4444', details: 'Oldest pink market, jewelry, textiles, lehariya ‚Ä¢ üìç Johri Bazaar, Jaipur', url: null },
            { name: 'Bapu Bazaar', city: 'Jaipur', position: { lat: 26.9248, lng: 75.8246 }, type: 'shopping', category: 'Street Shopping', icon: 'üõçÔ∏è', color: '#f59e0b', details: 'Men\'s suits, boots, ethnic wear ‚Ä¢ üìç Bapu Bazaar, Jaipur', url: null },
            { name: 'Kishanpole Bazar', city: 'Jaipur', position: { lat: 26.9248, lng: 75.8246 }, type: 'shopping', category: 'Traditional Market', icon: 'üè™', color: '#ef4444', details: 'Bandhani sarees, tie-dye fabrics ‚Ä¢ üìç Kishanpole Bazar, Jaipur', url: null },

            // UDAIPUR
            { name: 'Cityvibes Udaipur', city: 'Udaipur', position: { lat: 24.5854, lng: 73.7125 }, type: 'menswear', category: 'Ethnic Menswear', icon: 'üëî', color: '#3b82f6', details: 'Wedding wear, kurta pajamas, sherwanis ‚Ä¢ üìç Udaipur, Rajasthan', url: "cityvibes.in" },
            { name: 'Saptapadi Luxury Store', city: 'Udaipur', position: { lat: 24.5854, lng: 73.7125 }, type: 'menswear', category: 'Wedding Menswear', icon: 'üëî', color: '#3b82f6', details: 'Bespoke sartorial products, luxury wedding wear ‚Ä¢ üìç Udaipur Flagship', url: "saptapadistore.com" },
            { name: 'Manyavar Udaipur', city: 'Udaipur', position: { lat: 24.58, lng: 73.682 }, type: 'menswear', category: 'Ethnic Menswear', icon: 'üëî', color: '#3b82f6', details: 'Sherwanis, Indo-Western, Modi Kurta ‚Ä¢ üìç Bapu Bazar, Bhuwana, Udaipur', url: "manyavar.com" },
            { name: 'Jade Blue', city: 'Udaipur', position: { lat: 24.5858, lng: 73.6854 }, type: 'menswear', category: 'Ethnic & Western', icon: 'üëî', color: '#3b82f6', details: 'Evening shirts, blazers, Modi Kurta ‚Ä¢ üìç Court Chowaraha, Udaipur', url: "jadeblue.com" },
            { name: 'Raymond Udaipur', city: 'Udaipur', position: { lat: 24.5854, lng: 73.6872 }, type: 'menswear', category: 'Suiting', icon: 'üëî', color: '#3b82f6', details: 'Premium suits, tailoring ‚Ä¢ üìç Panchwati, Near Sukhadia Circle, Udaipur', url: "myraymond.com" },
            { name: 'Bapu Bazaar Udaipur', city: 'Udaipur', position: { lat: 24.58, lng: 73.682 }, type: 'shopping', category: 'Traditional Market', icon: 'üè™', color: '#ef4444', details: 'Bandhani sarees, embroidered textiles ‚Ä¢ üìç Bapu Bazaar, Udaipur', url: null },
            { name: 'Jagdish Chowk', city: 'Udaipur', position: { lat: 24.5794, lng: 73.6833 }, type: 'shopping', category: 'Heritage Market', icon: 'üèõÔ∏è', color: '#ef4444', details: 'Antique jewelry, hand-carved items ‚Ä¢ üìç Jagdish Chowk, Udaipur', url: null },
            { name: 'Hathi Pol Bazaar', city: 'Udaipur', position: { lat: 24.5794, lng: 73.6833 }, type: 'shopping', category: 'Antiques Market', icon: '‚ö±Ô∏è', color: '#92400e', details: 'Vintage jewelry, Rajput weaponry, antiques ‚Ä¢ üìç Hathi Pol Bazaar, Udaipur', url: null },
            { name: 'City Palace Boutiques', city: 'Udaipur', position: { lat: 24.576, lng: 73.6832 }, type: 'handicrafts', category: 'Royal Crafts', icon: 'üëë', color: '#9333ea', details: 'High-quality Mewar handicrafts ‚Ä¢ üìç City Palace Complex, Udaipur', url: null },
            { name: 'Umang Boutique', city: 'Udaipur', position: { lat: 24.5854, lng: 73.7125 }, type: 'fashion', category: 'Designer Fashion', icon: 'üëó', color: '#ec4899', details: 'Latest Indian designer patterns, ethnic wear ‚Ä¢ üìç Udaipur', url: null },

            // AGRA
            { name: 'Dimple Collection', city: 'Agra', position: { lat: 27.2046, lng: 78.0131 }, type: 'menswear', category: 'Ethnic Menswear', icon: 'üëî', color: '#3b82f6', details: 'Men\'s ethnic wear, kurtas, sherwanis ‚Ä¢ üìç E-21, Bypass Road, Kamla Nagar, Agra', url: "dimplecollection.in" },
            { name: 'Riti Riwaaz Collection', city: 'Agra', position: { lat: 27.2046, lng: 78.0131 }, type: 'menswear', category: 'Designer Menswear', icon: 'üëî', color: '#3b82f6', details: 'Sherwanis, blazers, Indo-Western ‚Ä¢ üìç E-90, Kamla Nagar, Agra', url: null },
            { name: 'Raymond Agra', city: 'Agra', position: { lat: 27.2152, lng: 77.9753 }, type: 'menswear', category: 'Suiting', icon: 'üëî', color: '#3b82f6', details: 'Classic suits, custom tailoring ‚Ä¢ üìç Sulabh Puram Colony, Sikandra, Agra', url: "myraymond.com" },
            { name: 'Blackberrys Agra', city: 'Agra', position: { lat: 27.1767, lng: 78.0081 }, type: 'menswear', category: 'Premium Menswear', icon: 'üëî', color: '#3b82f6', details: 'Premium formal and casual menswear ‚Ä¢ üìç MG Road, Sanjay Place, Agra', url: "blackberrys.com" },
            { name: 'Lifestyle Stores Agra', city: 'Agra', position: { lat: 27.1767, lng: 78.0081 }, type: 'shopping', category: 'Multi-brand', icon: 'üõçÔ∏è', color: '#64748b', details: 'Contemporary fashion, multi-brand mall store ‚Ä¢ üìç Ashok Cosmos Mall, Sanjay Place, Agra', url: "lifestylestores.com" },
            { name: 'Sadar Bazaar', city: 'Agra', position: { lat: 27.1903, lng: 78.0022 }, type: 'shopping', category: 'Traditional Market', icon: 'üè™', color: '#ef4444', details: 'Traditional shopping, textiles ‚Ä¢ üìç Sadar Bazaar, Agra', url: null },
            { name: 'Kinari Bazaar', city: 'Agra', position: { lat: 27.1751, lng: 78.0421 }, type: 'shopping', category: 'Textile Market', icon: 'üßµ', color: '#10b981', details: 'Textiles, embroidery, traditional crafts ‚Ä¢ üìç Kinari Bazaar, Agra', url: null },
            { name: 'Sanjay Place', city: 'Agra', position: { lat: 27.1767, lng: 78.0081 }, type: 'shopping', category: 'Shopping District', icon: 'üè¨', color: '#64748b', details: 'Modern retail, malls, branded stores ‚Ä¢ üìç Sanjay Place, Agra', url: null },

            // RANTHAMBORE
            { name: 'Dastkar Ranthambore', city: 'Ranthambore', position: { lat: 26.0173, lng: 76.3426 }, type: 'handicrafts', category: 'Handicrafts/Textiles', icon: 'üé®', color: '#8b5cf6', details: 'Community coop, handmade textiles, village crafts ‚Ä¢ üìç Sawai Madhopur, near Ranthambore', url: "dastkar.org" },
            { name: 'Village Women Craft', city: 'Ranthambore', position: { lat: 26.0173, lng: 76.3426 }, type: 'handicrafts', category: 'Community Crafts', icon: 'üé®', color: '#8b5cf6', details: 'Hand-carved items, paintings, textiles ‚Ä¢ üìç Sawai Madhopur', url: null },
            { name: 'Ranthambore School of Arts', city: 'Ranthambore', position: { lat: 26.0173, lng: 76.3426 }, type: 'handicrafts', category: 'Traditional Crafts', icon: 'üé®', color: '#8b5cf6', details: 'Batik, tie-dye, silver jewelry, Rajasthani items ‚Ä¢ üìç Sawai Madhopur', url: null },
            { name: 'The Tiger Shop', city: 'Ranthambore', position: { lat: 26.0173, lng: 76.3426 }, type: 'souvenirs', category: 'Souvenirs', icon: 'üéÅ', color: '#f59e0b', details: 'Tiger-print shirts, superfine Taj cotton fabric ‚Ä¢ üìç Sawai Madhopur', url: "thetigershop.in" },
            { name: 'Ranthambhore Maharani Handicrafts', city: 'Ranthambore', position: { lat: 26.0173, lng: 76.3426 }, type: 'handicrafts', category: 'Local Handicrafts', icon: 'üé®', color: '#8b5cf6', details: 'Quality local handicrafts, textiles ‚Ä¢ üìç Sawai Madhopur', url: null },
            { name: 'Dhonk Crafts', city: 'Ranthambore', position: { lat: 26.0173, lng: 76.3426 }, type: 'handicrafts', category: 'Eco Crafts', icon: 'üåø', color: '#10b981', details: 'Eco-conscious, conservation-focused products ‚Ä¢ üìç Sawai Madhopur', url: null },
        ];

        // City to day mapping for smart sidebar
        const dayToCityMap = {
            1: 'Udaipur', 2: 'Udaipur',
            3: 'Agra', 4: 'Agra',
            5: 'Ranthambore', 6: 'Ranthambore',
            7: 'Jaipur', 8: 'Jaipur', 9: 'Jaipur'
        };

        // Global boutique markers array
        let boutiqueMarkers = [];
        let currentCity = 'Udaipur';

        // --- RESTAURANT SELECTION STORAGE ---
        const STORAGE_KEY = 'trip_restaurant_selections';

        function generateEventId(dayIndex, eventIndex) {
            return `day${dayIndex}-event${eventIndex}`;
        }

        function getRestaurantSelection(eventId) {
            try {
                const selections = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                return selections[eventId] || null;
            } catch (e) {
                console.error('Error reading restaurant selections:', e);
                return null;
            }
        }

        function saveRestaurantSelection(eventId, restaurantId) {
            try {
                const selections = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                selections[eventId] = restaurantId;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(selections));
                return true;
            } catch (e) {
                console.error('Error saving restaurant selection:', e);
                return false;
            }
        }

        function clearRestaurantSelection(eventId) {
            try {
                const selections = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                delete selections[eventId];
                localStorage.setItem(STORAGE_KEY, JSON.stringify(selections));
            } catch (e) {
                console.error('Error clearing restaurant selection:', e);
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        function toggleRestaurantChoices(eventId) {
            const choicesDiv = document.getElementById(`choices-${eventId}`);
            const button = document.querySelector(`[data-toggle="${eventId}"]`);

            if (choicesDiv.classList.contains('hidden')) {
                choicesDiv.classList.remove('hidden');
                choicesDiv.classList.add('slide-down');
                if (button) button.textContent = button.textContent.replace('üîΩ', 'üîº');
            } else {
                choicesDiv.classList.add('hidden');
                if (button) button.textContent = button.textContent.replace('üîº', 'üîΩ');
            }
        }

        function sendRestaurantEmail(restaurantName, cuisine, date, eventId) {
            // Get the selected restaurant details
            const day = tripData[parseInt(eventId.split('-')[0].replace('day', '')) - 1];
            const subject = encodeURIComponent(`Restaurant Selection: ${restaurantName} for ${date}`);
            const body = encodeURIComponent(
                `Hello,\n\n` +
                `A restaurant has been selected for the India trip:\n\n` +
                `Date: ${date}\n` +
                `Restaurant: ${restaurantName}\n` +
                `Cuisine: ${cuisine}\n` +
                `Location: ${day.location}\n` +
                `Hotel: ${day.hotel}\n\n` +
                `This selection has been saved and can be changed at any time.\n\n` +
                `Best regards`
            );

            // Open email client with pre-filled content
            window.location.href = `mailto:anoopkansupada@gmail.com?subject=${subject}&body=${body}`;
        }

        function selectRestaurant(eventId, restaurantId, dayIndex, eventIndex) {
            if (saveRestaurantSelection(eventId, restaurantId)) {
                // Get the selected restaurant details
                const day = tripData[dayIndex];
                const event = day.events[eventIndex];
                const selectedRestaurant = event.restaurantOptions.find(r => r.id === restaurantId);

                if (selectedRestaurant) {
                    showToast('‚úì Restaurant saved! Opening email...');

                    // Send email with selection
                    setTimeout(() => {
                        sendRestaurantEmail(
                            selectedRestaurant.name,
                            selectedRestaurant.cuisine,
                            day.date,
                            eventId
                        );
                    }, 500);
                }

                setTimeout(() => {
                    renderTimeline('all');
                }, 1000);
            }
        }

        // --- RENDER FUNCTIONS ---

        function renderStandardEvent(event) {
            let titleHTML = event.title;
            if (event.url) {
                titleHTML = `<a href="${event.url}" target="_blank" class="restaurant-link">${event.title}</a>`;
            }

            return `
                <h4 class="font-bold text-gray-900 text-lg break-words">${titleHTML}</h4>
                <p class="text-sm text-gray-600 mt-1 break-words">${event.detail}</p>
            `;
        }

        function renderEnhancedRestaurantEvent(event) {
            const info = event.restaurantInfo;
            let titleHTML = event.title;
            if (event.url) {
                titleHTML = `<a href="${event.url}" target="_blank" class="restaurant-link">${event.title}</a>`;
            }

            return `
                <h4 class="font-bold text-gray-900 text-lg break-words">${titleHTML}</h4>
                <div class="mt-2">
                    <span class="cuisine-tag">${info.cuisine}</span>
                </div>
                <p class="text-sm text-gray-600 mt-2">${info.description}</p>
                ${info.highlights ? `
                    <div class="restaurant-highlights mt-2">
                        ${info.highlights.map(h => `<span>‚Ä¢ ${h}</span>`).join(' ')}
                    </div>
                ` : ''}
                <p class="text-xs text-gray-500 italic mt-2">${info.dressCode}</p>
                <p class="text-sm text-gray-600 mt-2">${event.detail}</p>
            `;
        }

        function renderAllInclusiveEvent(event) {
            let titleHTML = event.title;
            if (event.url) {
                titleHTML = `<a href="${event.url}" target="_blank" class="restaurant-link">${event.title}</a>`;
            }

            return `
                <h4 class="font-bold text-gray-900 text-lg break-words">${titleHTML}</h4>
                <div class="all-inclusive-badge">
                    <div class="all-inclusive-badge-header">
                        <span class="mr-2">‚úì</span> All-Inclusive Package
                    </div>
                    <p class="all-inclusive-badge-text">
                        ${event.restaurantInfo?.note || 'All meals managed by hotel'}
                    </p>
                </div>
                <p class="text-sm text-gray-600 mt-2">${event.detail}</p>
            `;
        }

        function renderMultipleChoiceEvent(event, eventId, dayIndex, eventIndex) {
            const savedSelection = getRestaurantSelection(eventId);
            const selectedRestaurant = savedSelection
                ? event.restaurantOptions.find(r => r.id === savedSelection)
                : null;

            if (selectedRestaurant) {
                // SELECTED STATE
                let titleHTML = `Dinner: ${selectedRestaurant.name}`;
                if (selectedRestaurant.url) {
                    titleHTML = `<a href="${selectedRestaurant.url}" target="_blank" class="restaurant-link">Dinner: ${selectedRestaurant.name}</a>`;
                }

                return `
                    <h4 class="font-bold text-gray-900 text-lg break-words">${titleHTML} ‚úì</h4>
                    <div class="selected-restaurant">
                        <div class="text-sm text-rose-900 font-medium mb-1">
                            ${selectedRestaurant.cuisine} ‚Ä¢ ${selectedRestaurant.dressCode}
                        </div>
                        <p class="text-sm text-gray-600">${event.detail}</p>
                        <button
                            onclick="toggleRestaurantChoices('${eventId}')"
                            class="mt-2 text-sm text-rose-700 hover:text-rose-900 font-medium underline"
                        >
                            Change Restaurant
                        </button>
                    </div>
                    <div id="choices-${eventId}" class="hidden restaurant-options-container">
                        ${event.restaurantOptions.map(restaurant => `
                            <label class="restaurant-option-card ${restaurant.id === savedSelection ? 'selected' : ''}">
                                <div class="flex items-start">
                                    <input
                                        type="radio"
                                        name="restaurant-${eventId}"
                                        value="${restaurant.id}"
                                        ${restaurant.id === savedSelection ? 'checked' : ''}
                                        onchange="selectRestaurant('${eventId}', '${restaurant.id}', ${dayIndex}, ${eventIndex})"
                                        class="mt-1 mr-3"
                                    />
                                    <div class="flex-1">
                                        <div class="font-bold text-gray-900 text-base mb-1">${restaurant.name}</div>
                                        <div class="cuisine-tag">${restaurant.cuisine}</div>
                                        <p class="text-sm text-gray-600 mt-2">${restaurant.description}</p>
                                        ${restaurant.highlights ? `
                                            <div class="restaurant-highlights">
                                                ${restaurant.highlights.map(h => `<span>‚Ä¢ ${h}</span>`).join(' ')}
                                            </div>
                                        ` : ''}
                                        <p class="text-xs text-gray-500 italic mt-2">${restaurant.dressCode}</p>
                                    </div>
                                </div>
                            </label>
                        `).join('')}
                    </div>
                `;
            } else {
                // COLLAPSED STATE (No Selection)
                let titleHTML = event.title;
                if (event.url) {
                    titleHTML = `<a href="${event.url}" target="_blank" class="restaurant-link">${event.title}</a>`;
                }

                return `
                    <h4 class="font-bold text-gray-900 text-lg break-words">${titleHTML}</h4>
                    <div class="restaurant-choice-toggle">
                        <button onclick="toggleRestaurantChoices('${eventId}')" data-toggle="${eventId}">
                            <span>üîΩ Choose Restaurant (${event.restaurantOptions.length} options)</span>
                        </button>
                    </div>
                    <div id="choices-${eventId}" class="hidden restaurant-options-container">
                        ${event.restaurantOptions.map(restaurant => `
                            <label class="restaurant-option-card">
                                <div class="flex items-start">
                                    <input
                                        type="radio"
                                        name="restaurant-${eventId}"
                                        value="${restaurant.id}"
                                        onchange="selectRestaurant('${eventId}', '${restaurant.id}', ${dayIndex}, ${eventIndex})"
                                        class="mt-1 mr-3"
                                    />
                                    <div class="flex-1">
                                        <div class="font-bold text-gray-900 text-base mb-1">${restaurant.name}</div>
                                        <div class="cuisine-tag">${restaurant.cuisine}</div>
                                        <p class="text-sm text-gray-600 mt-2">${restaurant.description}</p>
                                        ${restaurant.highlights ? `
                                            <div class="restaurant-highlights">
                                                ${restaurant.highlights.map(h => `<span>‚Ä¢ ${h}</span>`).join(' ')}
                                            </div>
                                        ` : ''}
                                        <p class="text-xs text-gray-500 italic mt-2">${restaurant.dressCode}</p>
                                    </div>
                                </div>
                            </label>
                        `).join('')}
                    </div>
                    <p class="text-sm text-gray-600 mt-2">${event.detail}</p>
                `;
            }
        }

        function renderTimeline(filter) {
            const container = document.getElementById('timeline-container');
            container.innerHTML = ''; // Clear existing

            tripData.forEach((day, index) => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'relative pl-8 sm:pl-10 py-2 group';
                dayDiv.setAttribute('data-day', index + 1); // Track day number for scroll detection

                // Vertical Line
                const line = document.createElement('div');
                line.className = 'absolute left-3 sm:left-4 top-0 bottom-0 w-0.5 bg-gray-200 group-last:bottom-auto group-last:h-full';
                dayDiv.appendChild(line);

                // Date Marker
                const marker = document.createElement('div');
                marker.className = 'absolute left-0 sm:left-1 w-6 h-6 sm:w-8 sm:h-8 bg-rose-900 rounded-full flex items-center justify-center text-white text-xs font-bold z-10 shadow-md';
                marker.innerText = (index + 1);
                dayDiv.appendChild(marker);

                // Content Block
                const content = document.createElement('div');
                content.className = 'mb-8';
                content.innerHTML = `
                    <div class="flex flex-col sm:flex-row sm:items-baseline mb-3">
                        <h3 class="text-xl font-bold text-gray-900 serif-font mr-3">${day.date}</h3>
                        <div class="flex flex-col sm:flex-row sm:items-baseline gap-2">
                            <span class="text-sm text-gray-500 font-medium uppercase tracking-wide">${day.location} ‚Ä¢ ${day.hotel}</span>
                            <span class="text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded font-semibold inline-block">üå°Ô∏è ${day.temp}</span>
                        </div>
                    </div>
                `;

                // Events List
                const eventList = document.createElement('div');
                eventList.className = 'space-y-3';
                
                let visibleEvents = 0;

                day.events.forEach((event, eventIndex) => {
                    if (filter !== 'all' && event.type !== filter) return;
                    visibleEvents++;

                    const eventId = generateEventId(index, eventIndex);

                    // Icon Selection
                    let icon = 'üìç';
                    let bgClass = 'bg-white border-l-4 border-gray-300';
                    if (event.type === 'logistics') { icon = 'üöê'; bgClass = 'bg-gray-50 border-l-4 border-gray-400'; }
                    if (event.type === 'dining') { icon = 'üçΩÔ∏è'; bgClass = 'bg-white border-l-4 border-amber-500'; }
                    if (event.type === 'culture') { icon = 'üì∑'; bgClass = 'bg-white border-l-4 border-rose-700'; }
                    if (event.type === 'leisure') { icon = 'üçπ'; bgClass = 'bg-blue-50 border-l-4 border-blue-400'; }

                    const eventCard = document.createElement('div');
                    eventCard.className = `luxury-card p-4 rounded shadow-sm ${bgClass}`;

                    // Determine rendering mode
                    let contentHTML = '';

                    if (event.hasMultipleOptions && event.restaurantOptions) {
                        // MULTIPLE CHOICE MODE
                        contentHTML = renderMultipleChoiceEvent(event, eventId, index, eventIndex);
                    } else if (event.allInclusive) {
                        // ALL-INCLUSIVE MODE
                        contentHTML = renderAllInclusiveEvent(event);
                    } else if (event.restaurantInfo) {
                        // SINGLE ENHANCED MODE
                        contentHTML = renderEnhancedRestaurantEvent(event);
                    } else {
                        // STANDARD MODE
                        contentHTML = renderStandardEvent(event);
                    }

                    eventCard.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider">
                                    <span class="mr-2 text-base">${icon}</span> ${event.time}
                                </div>
                                ${contentHTML}
                            </div>
                        </div>
                    `;

                    eventList.appendChild(eventCard);
                });

                if (visibleEvents > 0) {
                    content.appendChild(eventList);
                    dayDiv.appendChild(content);
                    container.appendChild(dayDiv);
                }
            });
        }

        function renderDining() {
            const container = document.getElementById('dining-list');
            container.innerHTML = '';
            diningHighlights.forEach(place => {
                // Link logic
                let nameHTML = place.name;
                if (place.url) {
                    nameHTML = `<a href="${place.url}" target="_blank" class="restaurant-link">${place.name}</a>`;
                }

                const div = document.createElement('div');
                div.className = "flex justify-between items-start border-b border-gray-100 pb-3 last:border-0";
                div.innerHTML = `
                    <div>
                        <div class="font-bold text-gray-800">${nameHTML}</div>
                        <div class="text-xs text-gray-500">${place.loc}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs bg-amber-100 text-amber-800 px-2 py-1 rounded inline-block mb-1">${place.note}</div>
                        <div class="text-xs text-gray-400 italic">${place.dress}</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderCharts() {
            const ctx = document.getElementById('balanceChart').getContext('2d');

            // Smart duration calculator with reasonable defaults by keyword
            const getDuration = (event) => {
                // Check for explicit duration first (e.g., "Drive to Ranthambore (~5 hours)")
                const explicitMatch = event.detail.match(/[~(](\d+(?:\.\d+)?)\s*(?:hours?|hrs?)[)~]/i);
                if (explicitMatch) return parseFloat(explicitMatch[1]);

                // Keyword-based estimation
                const title = event.title.toLowerCase();
                const detail = event.detail.toLowerCase();
                const combined = title + ' ' + detail;

                // Dining defaults
                if (event.type === 'dining') {
                    if (combined.includes('breakfast')) return 1;
                    if (combined.includes('lunch')) return 1.5;
                    if (combined.includes('dinner')) return 2;
                    if (combined.includes('boxes')) return 0.5;
                    return 1.5; // default meal
                }

                // Logistics defaults
                if (event.type === 'logistics') {
                    if (combined.includes('flight')) return 2;
                    if (combined.includes('drive')) return 4; // average drive
                    if (combined.includes('check-in') || combined.includes('checkout')) return 0.5;
                    if (combined.includes('transfer') || combined.includes('pickup')) return 0.75;
                    return 1;
                }

                // Culture defaults
                if (event.type === 'culture') {
                    if (combined.includes('safari')) return 4;
                    if (combined.includes('elefantastic') || combined.includes('elephant')) return 4;
                    if (combined.includes('fort') || combined.includes('palace') || combined.includes('tour')) return 3;
                    if (combined.includes('workshop') || combined.includes('painting') || combined.includes('art')) return 1.5;
                    if (combined.includes('boat')) return 1;
                    return 2.5; // default cultural activity
                }

                // Leisure defaults
                if (event.type === 'leisure') {
                    if (combined.includes('spa')) return 2.5;
                    if (combined.includes('birthday activities')) return 3;
                    if (combined.includes('leisure') || combined.includes('relaxation')) return 2;
                    return 1.5;
                }

                return 1; // absolute fallback
            };

            // Calculate hours by type
            let cultureHours = 0, diningHours = 0, leisureHours = 0, logisticsHours = 0;

            tripData.forEach(day => {
                day.events.forEach(event => {
                    const duration = getDuration(event);
                    if (event.type === 'culture') cultureHours += duration;
                    else if (event.type === 'dining') diningHours += duration;
                    else if (event.type === 'leisure') leisureHours += duration;
                    else if (event.type === 'logistics') logisticsHours += duration;
                });
            });

            const data = {
                labels: ['Culture & Sightseeing', 'Dining & Social', 'Leisure & Relax', 'Logistics & Travel'],
                datasets: [{
                    data: [cultureHours, diningHours, leisureHours, logisticsHours],
                    backgroundColor: [
                        '#be123c', // Culture (Rose 700)
                        '#f59e0b', // Dining (Amber 500)
                        '#60a5fa', // Leisure (Blue 400)
                        '#9ca3af'  // Logistics (Gray 400)
                    ],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            };

            new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: "'Lato', sans-serif", size: 10 },
                                boxWidth: 10
                            }
                        }
                    },
                    layout: {
                        padding: 10
                    }
                }
            });
        }

        // --- EXPORT FUNCTIONALITY (THE USER REQUEST) ---
        function exportToCSV() {
            // Header
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Date,Time,Location,Activity,Category,Notes,Emails\n";

            // Emails included for sharing
            const emails = "bkansupada@gmail.com, reservations@oberoigroup.com";

            // Rows
            tripData.forEach(day => {
                day.events.forEach(event => {
                    // Escape commas in fields
                    const cleanTitle = event.title.replace(/,/g, " ");
                    const cleanDetail = event.detail.replace(/,/g, " ");
                    const row = `${day.date},${event.time},${day.location},${cleanTitle},${event.type},${cleanDetail},"${emails}"`;
                    csvContent += row + "\n";
                });
            });

            // Download Trigger
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "Kansupada_India_Itinerary_Detailed.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function filterTimeline(type) {
            // Update buttons
            document.querySelectorAll('button[id^="btn-"]').forEach(btn => {
                btn.classList.remove('bg-gray-200', 'font-medium', 'text-gray-700');
                btn.classList.add('bg-white', 'text-gray-600');
            });
            const activeBtn = document.getElementById(`btn-${type}`);
            activeBtn.classList.remove('bg-white', 'text-gray-600');
            activeBtn.classList.add('bg-gray-200', 'font-medium', 'text-gray-700');

            renderTimeline(type);
        }

        // --- BOUTIQUES FUNCTIONS ---

        // Get boutiques for a specific city
        function getCityBoutiques(city, maxCount = 5) {
            const cityBoutiques = boutiquesData.filter(b => b.city === city);
            // Prioritize boutiques with URLs
            return cityBoutiques
                .sort((a, b) => {
                    if (a.url && !b.url) return -1;
                    if (!a.url && b.url) return 1;
                    return 0;
                })
                .slice(0, maxCount);
        }

        // Render shopping sidebar
        function renderShoppingSidebar(city, boutiques) {
            const cityNameEl = document.getElementById('shopping-city-name');
            const countEl = document.getElementById('shopping-count');
            const listEl = document.getElementById('shopping-sidebar-list');

            if (!boutiques || boutiques.length === 0) {
                listEl.innerHTML = '<p class="text-sm text-gray-500 italic">No boutiques listed for this city</p>';
                cityNameEl.textContent = city;
                countEl.textContent = '0 boutiques';
                return;
            }

            cityNameEl.textContent = city;
            countEl.textContent = `${boutiques.length} boutiques`;

            // Update "View All" link with city parameter
            const viewAllLink = document.getElementById('shopping-view-all');
            if (viewAllLink) {
                viewAllLink.href = `shopping.html?city=${encodeURIComponent(city)}`;
            }

            listEl.innerHTML = '';
            boutiques.forEach(boutique => {
                const card = document.createElement('div');
                card.className = 'boutique-card border-b border-gray-100 pb-3 last:border-0';
                card.setAttribute('data-boutique-name', boutique.name);

                const nameLink = boutique.url
                    ? `<a href="https://${boutique.url}" target="_blank" class="font-bold text-gray-800 hover:text-rose-700">${boutique.name}</a>`
                    : `<span class="font-bold text-gray-800">${boutique.name}</span>`;

                card.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">${boutique.icon}</span>
                                ${nameLink}
                            </div>
                            <div class="text-xs text-gray-500">${boutique.category}</div>
                            <div class="text-xs text-gray-400 italic">${boutique.details.split(' ‚Ä¢ ')[0]}</div>
                        </div>
                        <button class="show-on-map-btn text-xs text-blue-600 hover:underline whitespace-nowrap ml-2">
                            Show on Map
                        </button>
                    </div>
                `;

                // Add click handler for "Show on Map"
                card.querySelector('.show-on-map-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const marker = boutiqueMarkers.find(m => m.title === boutique.name);
                    if (marker && marker.map) {
                        marker.map.panTo(marker.getPosition());
                        marker.map.setZoom(15);
                        marker.infoWindow.open(marker.map, marker);
                        marker.setAnimation(google.maps.Animation.BOUNCE);
                        setTimeout(() => marker.setAnimation(null), 2000);
                    }
                });

                listEl.appendChild(card);
            });
        }

        // Update category counts in dropdown
        function updateCategoryCounts() {
            const counts = {};
            boutiquesData.forEach(b => {
                counts[b.type] = (counts[b.type] || 0) + 1;
            });

            document.querySelectorAll('#shopping-dropdown input[type="checkbox"]').forEach(checkbox => {
                const category = checkbox.getAttribute('data-category');
                const label = checkbox.parentElement;
                const countSpan = label.querySelector('.count');
                if (countSpan && counts[category]) {
                    countSpan.textContent = `(${counts[category]})`;
                }
            });
        }

        // Toggle boutique markers visibility
        function toggleBoutiqueMarkers(category, show) {
            boutiqueMarkers.forEach(marker => {
                if (marker.boutiqueType === category) {
                    marker.setVisible(show);
                }
            });
        }

        // --- MAP INITIALIZATION ---
        // Note: This function is called by the Google Maps API callback
        window.initMap = function() {
            // Initialize Google Map centered on Rajasthan
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 6,
                center: { lat: 25.0, lng: 76.0 },
                mapTypeId: 'roadmap',
                styles: [
                    {
                        featureType: 'poi',
                        elementType: 'labels',
                        stylers: [{ visibility: 'on' }]
                    }
                ]
            });

            // Actual hotel and airport coordinates (Google Maps uses {lat, lng} objects)
            const locations = [
                {
                    name: 'Oberoi Udaivilas',
                    city: 'Udaipur',
                    position: { lat: 24.5768, lng: 73.6805 },
                    address: 'Haridasji Ki Magri, Udaipur, Rajasthan 313001',
                    days: 'Day 1-2 (Dec 17-18)',
                    color: '#dc2626',
                    details: 'Lake Palace views ‚Ä¢ City Palace tour ‚Ä¢ Sunset boat ride',
                    number: 1
                },
                {
                    name: 'Oberoi Amarvilas',
                    city: 'Agra',
                    position: { lat: 27.1751, lng: 78.0421 },
                    address: 'Taj East Gate Road, Agra, Uttar Pradesh 282001',
                    days: 'Day 3-4 (Dec 19-20)',
                    color: '#2563eb',
                    details: 'Taj Mahal sunrise tour ‚Ä¢ All rooms with Taj views',
                    number: 2
                },
                {
                    name: 'Oberoi Vanyavilas',
                    city: 'Ranthambore',
                    position: { lat: 26.0173, lng: 76.5026 },
                    address: 'Ranthambore Road, Sawai Madhopur, Rajasthan 322001',
                    days: 'Day 4-6 (Dec 20-22)',
                    color: '#16a34a',
                    details: 'Tiger safari ‚Ä¢ Luxury tents ‚Ä¢ Spa treatments',
                    number: 3
                },
                {
                    name: 'Oberoi Rajvilas',
                    city: 'Jaipur',
                    position: { lat: 26.9124, lng: 75.7873 },
                    address: 'Goner Road, Jaipur, Rajasthan 303012',
                    days: 'Day 6-9 (Dec 22-25)',
                    color: '#9333ea',
                    details: "Zane's Birthday ‚Ä¢ Elefantastic ‚Ä¢ Amber Fort ‚Ä¢ Shopping",
                    number: 4
                }
            ];

            // Airports
            const airports = [
                {
                    name: 'Chhatrapati Shivaji Airport (BOM)',
                    position: { lat: 19.0896, lng: 72.8656 },
                    city: 'Mumbai',
                    type: 'start-end'
                },
                {
                    name: 'Maharana Pratap Airport (UDR)',
                    position: { lat: 24.6177, lng: 73.8961 },
                    city: 'Udaipur'
                },
                {
                    name: 'Indira Gandhi Airport (DEL)',
                    position: { lat: 28.5562, lng: 77.1000 },
                    city: 'Delhi'
                },
                {
                    name: 'Jaipur Airport (JAI)',
                    position: { lat: 26.8242, lng: 75.8122 },
                    city: 'Jaipur'
                }
            ];

            // Points of Interest - Restaurants, Attractions, Shopping
            const pointsOfInterest = [
                // UDAIPUR
                {
                    name: 'Taj Lake Palace',
                    position: { lat: 24.5760, lng: 73.6803 },
                    type: 'restaurant',
                    icon: 'üçΩÔ∏è',
                    color: '#f59e0b',
                    details: 'Dec 17 Dinner ‚Ä¢ Boat access from hotel ‚Ä¢ Smart Casual to Elegant',
                    url: 'https://www.tajhotels.com/en-in/taj/taj-lake-palace-udaipur/dining/'
                },
                {
                    name: 'City Palace Udaipur',
                    position: { lat: 24.5760, lng: 73.6832 },
                    type: 'attraction',
                    icon: 'üè∞',
                    color: '#dc2626',
                    details: 'Dec 18, 10:00 AM tour ‚Ä¢ Kid-friendly guide ‚Ä¢ Lakeside palace complex'
                },
                {
                    name: 'Ambrai Restaurant',
                    position: { lat: 24.5772, lng: 73.6826 },
                    type: 'restaurant',
                    icon: 'üçΩÔ∏è',
                    color: '#f59e0b',
                    details: 'Dec 18 Lunch, 12:30 PM ‚Ä¢ Lakeside seating ‚Ä¢ City Palace views ‚Ä¢ 10 people, high chair'
                },
                {
                    name: 'Shyam Arts (Miniature Painting)',
                    position: { lat: 24.5800, lng: 73.6850 },
                    type: 'activity',
                    icon: 'üé®',
                    color: '#8b5cf6',
                    details: 'Dec 18, ~4:00 PM ‚Ä¢ Miniature painting workshop ‚Ä¢ Complimentary via hotel'
                },
                // AGRA
                {
                    name: 'Taj Mahal',
                    position: { lat: 27.1751, lng: 78.0421 },
                    type: 'attraction',
                    icon: 'üïå',
                    color: '#dc2626',
                    details: 'Dec 20, 6:00 AM sunrise tour ‚Ä¢ Private guide ‚Ä¢ Kids breakfast boxes ready at 6:00 AM'
                },
                // JAIPUR
                {
                    name: 'Giardino at Jai Mahal Palace',
                    position: { lat: 26.9158, lng: 75.7890 },
                    type: 'restaurant',
                    icon: 'üçΩÔ∏è',
                    color: '#f59e0b',
                    details: 'Dec 22 Dinner, 6:00 PM ‚Ä¢ 10 people, high chair ‚Ä¢ Smart Casual'
                },
                {
                    name: 'Elefantastic',
                    position: { lat: 26.9850, lng: 75.8250 },
                    type: 'attraction',
                    icon: 'üêò',
                    color: '#dc2626',
                    details: "Dec 23, 9:30 AM ‚Ä¢ THE anchor experience ‚Ä¢ Zane's birthday gift ‚Ä¢ ALL 10 people",
                    url: 'https://www.elefantastic.in/'
                },
                {
                    name: 'The Verandah at Rambagh Palace',
                    position: { lat: 26.8986, lng: 75.7891 },
                    type: 'restaurant',
                    icon: 'üçΩÔ∏è',
                    color: '#f59e0b',
                    details: 'Dec 23 Lunch, ~1:30 PM ‚Ä¢ 10 people, high chair ‚Ä¢ Smart Casual to Elegant'
                },
                {
                    name: 'Wink at The Lalit Jaipur',
                    position: { lat: 26.9203, lng: 75.8024 },
                    type: 'restaurant',
                    icon: 'üçΩÔ∏è',
                    color: '#f59e0b',
                    details: 'Dec 23 Dinner, 6:00 PM ‚Ä¢ Contemporary dining ‚Ä¢ 10 people, high chair ‚Ä¢ Smart Casual'
                },
                {
                    name: 'Amber Fort',
                    position: { lat: 26.9855, lng: 75.8513 },
                    type: 'attraction',
                    icon: 'üè∞',
                    color: '#dc2626',
                    details: 'Dec 24, 9:00 AM ‚Ä¢ Jeep ascent ‚Ä¢ Kid-friendly guide'
                },
                {
                    name: 'Steam (Pizza) at Rambagh Palace',
                    position: { lat: 26.8986, lng: 75.7891 },
                    type: 'restaurant',
                    icon: 'üçï',
                    color: '#f59e0b',
                    details: "üéÇ Dec 24 Birthday Lunch, 2:00 PM ‚Ä¢ Zane's 3rd Birthday! ‚Ä¢ Train pizza ‚Ä¢ 10 people, high chair"
                },
                {
                    name: 'Gem Palace Jaipur',
                    position: { lat: 26.9258, lng: 75.8236 },
                    type: 'shopping',
                    icon: 'üíé',
                    color: '#06b6d4',
                    details: 'Shopping ‚Ä¢ Jewelry & textiles ‚Ä¢ Arrange transportation with hotel'
                }
            ];

            // Bounds for auto-fitting the map
            const bounds = new google.maps.LatLngBounds();

            // Add markers for each hotel location
            locations.forEach((location) => {
                // Create custom numbered marker with colored background
                const marker = new google.maps.Marker({
                    position: location.position,
                    map: map,
                    title: location.name,
                    label: {
                        text: location.number.toString(),
                        color: 'white',
                        fontSize: '14px',
                        fontWeight: 'bold'
                    },
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 16,
                        fillColor: location.color,
                        fillOpacity: 1,
                        strokeColor: 'white',
                        strokeWeight: 3
                    }
                });

                // Info window content
                const infoContent = `
                    <div style="font-family: 'Lato', sans-serif; max-width: 250px;">
                        <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold; color: #1f2937;">${location.name}</h3>
                        <p style="margin: 0 0 4px 0; font-size: 14px; color: ${location.color}; font-weight: 600;">${location.days}</p>
                        <p style="margin: 0 0 6px 0; font-size: 12px; color: #9ca3af; font-style: italic;">${location.address}</p>
                        <p style="margin: 0; font-size: 13px; color: #6b7280; line-height: 1.4;">${location.details}</p>
                    </div>
                `;

                const infoWindow = new google.maps.InfoWindow({
                    content: infoContent
                });

                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });

                bounds.extend(location.position);
            });

            // Add airport markers
            airports.forEach(airport => {
                const isMumbai = airport.type === 'start-end';

                const marker = new google.maps.Marker({
                    position: airport.position,
                    map: map,
                    title: airport.name,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: isMumbai ? 14 : 12,
                        fillColor: isMumbai ? '#059669' : '#6b7280',
                        fillOpacity: 1,
                        strokeColor: 'white',
                        strokeWeight: 2
                    },
                    label: {
                        text: '‚úà',
                        color: 'white',
                        fontSize: '12px'
                    }
                });

                const infoContent = `
                    <div style="font-family: 'Lato', sans-serif;">
                        <h3 style="margin: 0 0 4px 0; font-size: 14px; font-weight: bold; color: #1f2937;">${airport.name}</h3>
                        <p style="margin: 0; font-size: 12px; color: #6b7280;">${airport.city}${isMumbai ? ' ‚Ä¢ START/END' : ''}</p>
                    </div>
                `;

                const infoWindow = new google.maps.InfoWindow({
                    content: infoContent
                });

                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });

                bounds.extend(airport.position);
            });

            // Add Points of Interest (Restaurants, Attractions, Shopping)
            pointsOfInterest.forEach(poi => {
                const marker = new google.maps.Marker({
                    position: poi.position,
                    map: map,
                    title: poi.name,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 10,
                        fillColor: poi.color,
                        fillOpacity: 0.9,
                        strokeColor: 'white',
                        strokeWeight: 2
                    },
                    label: {
                        text: poi.icon,
                        color: 'white',
                        fontSize: '10px'
                    }
                });

                // Build info content with optional link
                let infoContent = `
                    <div style="font-family: 'Lato', sans-serif; max-width: 280px;">
                        <div style="display: flex; align-items: center; margin-bottom: 6px;">
                            <span style="font-size: 20px; margin-right: 8px;">${poi.icon}</span>
                            <h3 style="margin: 0; font-size: 15px; font-weight: bold; color: #1f2937;">${poi.name}</h3>
                        </div>
                        <p style="margin: 0 0 4px 0; font-size: 12px; color: ${poi.color}; font-weight: 600; text-transform: uppercase;">${poi.type}</p>
                        <p style="margin: 0; font-size: 13px; color: #6b7280; line-height: 1.4;">${poi.details}</p>
                `;

                if (poi.url) {
                    infoContent += `<a href="${poi.url}" target="_blank" style="display: inline-block; margin-top: 8px; font-size: 12px; color: #2563eb; text-decoration: none; font-weight: 600;">View Details ‚Üí</a>`;
                }

                infoContent += `</div>`;

                const infoWindow = new google.maps.InfoWindow({
                    content: infoContent
                });

                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });

                bounds.extend(poi.position);
            });

            // Helper function to create info window for routes
            function createRouteInfoWindow(content) {
                return new google.maps.InfoWindow({
                    content: `<div style="font-family: 'Lato', sans-serif; font-size: 13px;">${content}</div>`
                });
            }

            // Draw route lines between locations
            const bomAirport = airports[0]; // Mumbai
            const udrAirport = airports[1]; // Udaipur
            const delAirport = airports[2]; // Delhi
            const jaiAirport = airports[3]; // Jaipur

            // 1. ARRIVAL: Flight from Mumbai to Udaipur - Dec 17
            const route1 = new google.maps.Polyline({
                path: [bomAirport.position, udrAirport.position],
                geodesic: true,
                strokeColor: '#059669',
                strokeOpacity: 0.8,
                strokeWeight: 4,
                icons: [{
                    icon: { path: 'M 0,-1 0,1', strokeOpacity: 1, scale: 4 },
                    offset: '0',
                    repeat: '20px'
                }],
                map: map
            });
            const info1 = createRouteInfoWindow('‚úàÔ∏è <strong>DAY 1:</strong> Flight AI 2579<br>Mumbai (BOM) ‚Üí Udaipur (UDR)<br>Dec 17, 10:30 AM - 12:00 PM');
            route1.addListener('click', (e) => { info1.setPosition(e.latLng); info1.open(map); });

            // 2. Flight path from Udaipur to Delhi - Dec 19
            const route2 = new google.maps.Polyline({
                path: [udrAirport.position, delAirport.position],
                geodesic: true,
                strokeColor: '#3b82f6',
                strokeOpacity: 0.6,
                strokeWeight: 3,
                icons: [{
                    icon: { path: 'M 0,-1 0,1', strokeOpacity: 1, scale: 3 },
                    offset: '0',
                    repeat: '20px'
                }],
                map: map
            });
            const info2 = createRouteInfoWindow('‚úàÔ∏è <strong>DAY 3:</strong> Flight<br>Udaipur (UDR) ‚Üí Delhi (DEL)<br>Dec 19, ~11:00 AM');
            route2.addListener('click', (e) => { info2.setPosition(e.latLng); info2.open(map); });

            // 3. Drive from Delhi to Agra - Dec 19
            const route3 = new google.maps.Polyline({
                path: [delAirport.position, locations[1].position],
                geodesic: true,
                strokeColor: '#f59e0b',
                strokeOpacity: 0.7,
                strokeWeight: 4,
                map: map
            });
            const info3 = createRouteInfoWindow('üöô <strong>DAY 3:</strong> Drive<br>Delhi ‚Üí Agra via Yamuna Expressway<br>~3.5 hours, Dec 19');
            route3.addListener('click', (e) => { info3.setPosition(e.latLng); info3.open(map); });

            // 4. Drive from Agra to Ranthambore - Dec 20
            const route4 = new google.maps.Polyline({
                path: [locations[1].position, locations[2].position],
                geodesic: true,
                strokeColor: '#f59e0b',
                strokeOpacity: 0.7,
                strokeWeight: 4,
                map: map
            });
            const info4 = createRouteInfoWindow('üöô <strong>DAY 4:</strong> Drive<br>Agra ‚Üí Ranthambore<br>~5 hours, Dec 20');
            route4.addListener('click', (e) => { info4.setPosition(e.latLng); info4.open(map); });

            // 5. Drive from Ranthambore to Jaipur - Dec 22
            const route5 = new google.maps.Polyline({
                path: [locations[2].position, locations[3].position],
                geodesic: true,
                strokeColor: '#f59e0b',
                strokeOpacity: 0.7,
                strokeWeight: 4,
                map: map
            });
            const info5 = createRouteInfoWindow('üöô <strong>DAY 6:</strong> Drive<br>Ranthambore ‚Üí Jaipur<br>~3.5 hours, Dec 22');
            route5.addListener('click', (e) => { info5.setPosition(e.latLng); info5.open(map); });

            // 6. DEPARTURE: Flight from Jaipur to Mumbai - Dec 25
            const route6 = new google.maps.Polyline({
                path: [jaiAirport.position, bomAirport.position],
                geodesic: true,
                strokeColor: '#059669',
                strokeOpacity: 0.8,
                strokeWeight: 4,
                icons: [{
                    icon: { path: 'M 0,-1 0,1', strokeOpacity: 1, scale: 4 },
                    offset: '0',
                    repeat: '20px'
                }],
                map: map
            });
            const info6 = createRouteInfoWindow('‚úàÔ∏è <strong>DAY 9:</strong> Flight Departure<br>Jaipur (JAI) ‚Üí Mumbai (BOM)<br>Dec 25, 7:55 PM');
            route6.addListener('click', (e) => { info6.setPosition(e.latLng); info6.open(map); });

            // Add Boutique Markers
            boutiquesData.forEach(boutique => {
                const marker = new google.maps.Marker({
                    position: boutique.position,
                    map: map,
                    title: boutique.name,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 8,
                        fillColor: boutique.color,
                        fillOpacity: 0.85,
                        strokeColor: 'white',
                        strokeWeight: 2
                    },
                    label: {
                        text: boutique.icon,
                        color: 'white',
                        fontSize: '9px'
                    }
                });

                // Store boutique type for filtering
                marker.boutiqueType = boutique.type;

                // Build info window content
                let infoContent = `
                    <div style="font-family: 'Lato', sans-serif; max-width: 300px;">
                        <div style="display: flex; align-items: center; margin-bottom: 6px;">
                            <span style="font-size: 20px; margin-right: 8px;">${boutique.icon}</span>
                            <h3 style="margin: 0; font-size: 15px; font-weight: bold; color: #1f2937;">${boutique.name}</h3>
                        </div>
                        <p style="margin: 0 0 4px 0; font-size: 12px; color: ${boutique.color}; font-weight: 600; text-transform: uppercase;">${boutique.category} ‚Ä¢ ${boutique.city}</p>
                        <p style="margin: 0; font-size: 13px; color: #6b7280; line-height: 1.4;">${boutique.details}</p>
                `;

                if (boutique.url) {
                    const fullUrl = boutique.url.startsWith('http') ? boutique.url : `https://${boutique.url}`;
                    infoContent += `<a href="${fullUrl}" target="_blank" style="display: inline-block; margin-top: 8px; font-size: 12px; color: #2563eb; text-decoration: none; font-weight: 600;">Visit Website ‚Üí</a>`;
                }

                infoContent += `</div>`;

                const infoWindow = new google.maps.InfoWindow({
                    content: infoContent
                });

                marker.infoWindow = infoWindow;

                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });

                // Highlight sidebar card on marker hover
                marker.addListener('mouseover', () => {
                    const card = document.querySelector(`[data-boutique-name="${boutique.name}"]`);
                    if (card) {
                        card.classList.add('highlighted');
                    }
                });

                marker.addListener('mouseout', () => {
                    const card = document.querySelector(`[data-boutique-name="${boutique.name}"]`);
                    if (card) {
                        card.classList.remove('highlighted');
                    }
                });

                boutiqueMarkers.push(marker);
                bounds.extend(boutique.position);
            });

            // Setup map controls
            const shoppingToggle = document.getElementById('shopping-toggle');
            const shoppingDropdown = document.getElementById('shopping-dropdown');

            // Toggle dropdown
            shoppingToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                shoppingDropdown.classList.toggle('open');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!shoppingDropdown.contains(e.target) && e.target !== shoppingToggle) {
                    shoppingDropdown.classList.remove('open');
                }
            });

            // Category checkboxes
            document.querySelectorAll('#shopping-dropdown input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const category = e.target.getAttribute('data-category');
                    const show = e.target.checked;
                    toggleBoutiqueMarkers(category, show);
                });
            });

            // Show All / Hide All buttons
            document.getElementById('show-all-shopping').addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('#shopping-dropdown input[type="checkbox"]').forEach(cb => {
                    cb.checked = true;
                    toggleBoutiqueMarkers(cb.getAttribute('data-category'), true);
                });
            });

            document.getElementById('hide-all-shopping').addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('#shopping-dropdown input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    toggleBoutiqueMarkers(cb.getAttribute('data-category'), false);
                });
            });

            // Update category counts
            updateCategoryCounts();

            // Initial sidebar render
            const initialBoutiques = getCityBoutiques(currentCity);
            renderShoppingSidebar(currentCity, initialBoutiques);

            // Set up dynamic city detection based on scroll position
            setupDynamicCityDetection();

            // Fit map to show all locations
            map.fitBounds(bounds);
        }

        // Detect which city is currently in view and update sidebar
        function setupDynamicCityDetection() {
            const timelineContainer = document.getElementById('timeline-container');
            if (!timelineContainer) return;

            let ticking = false;

            function updateCurrentCity() {
                // Get all day sections
                const daySections = timelineContainer.querySelectorAll('[data-day]');
                if (!daySections.length) return;

                // Find which day section is most in view
                let currentDayInView = 1;
                let maxVisibility = 0;

                const viewportTop = window.scrollY;
                const viewportBottom = viewportTop + window.innerHeight;
                const viewportMiddle = viewportTop + (window.innerHeight / 2);

                daySections.forEach(section => {
                    const dayNum = parseInt(section.getAttribute('data-day'));
                    const rect = section.getBoundingClientRect();
                    const sectionTop = rect.top + window.scrollY;
                    const sectionBottom = sectionTop + rect.height;

                    // Calculate how much of the section is visible
                    const visibleTop = Math.max(sectionTop, viewportTop);
                    const visibleBottom = Math.min(sectionBottom, viewportBottom);
                    const visibleHeight = Math.max(0, visibleBottom - visibleTop);

                    // Prefer sections that contain the viewport middle
                    const containsMiddle = sectionTop <= viewportMiddle && viewportMiddle <= sectionBottom;
                    const visibility = containsMiddle ? visibleHeight * 2 : visibleHeight;

                    if (visibility > maxVisibility) {
                        maxVisibility = visibility;
                        currentDayInView = dayNum;
                    }
                });

                // Map day to city
                const newCity = dayToCityMap[currentDayInView] || 'Mumbai';

                // Only update if city changed
                if (newCity !== currentCity) {
                    currentCity = newCity;
                    const cityBoutiques = getCityBoutiques(currentCity);
                    renderShoppingSidebar(currentCity, cityBoutiques);
                }

                ticking = false;
            }

            // Throttled scroll handler
            function onScroll() {
                if (!ticking) {
                    window.requestAnimationFrame(updateCurrentCity);
                    ticking = true;
                }
            }

            // Listen to scroll events
            window.addEventListener('scroll', onScroll);

            // Also update when timeline filter changes
            const originalRenderTimeline = window.renderTimeline;
            window.renderTimeline = function(...args) {
                originalRenderTimeline.apply(this, args);
                setTimeout(updateCurrentCity, 100); // Give time for DOM to update
            };

            // Initial check
            updateCurrentCity();
        }

        // --- INIT ---
        // Note: initMap is called automatically by Google Maps API callback
        // Other rendering functions are called on DOM load
        window.addEventListener('DOMContentLoaded', function() {
            renderTimeline('all');
            renderDining();
            renderCharts();
        });

    </script>
</body>
</html>