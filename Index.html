<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Kansupada-Oberoi Royal Expedition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Royal Rajasthan -->
    <!-- 
        Primary Background: #FDFBF7 (Warm Sandstone)
        Text: #1F2937 (Charcoal)
        Accent: #9F1239 (Mughal Red) for calls to action/highlights
        Secondary: #B45309 (Marigold/Saffron) for subheaders
        Tertiary: #064E3B (Royal Green) for nature/safari elements
    -->

    <!-- Application Structure Plan: 
         1. Header & Quick Stats: Immediate high-level overview for the VC/Strategist.
         2. Interactive Master Timeline: The core feature. A day-by-day scroller with clear times, locations, and "Vibe" indicators.
         3. The "Export" Utility: A prominent button to download the CSV for Google Sheets import (Requested specifically).
         4. Concierge Details (Tabs): 
            - Dining Ledger: Specific restaurants, cuisines, and dress codes.
            - Logistics & Packing: Flight numbers, outfit advice per location.
         5. Visual Analysis: Charts showing the balance of culture vs. chill to reassure the parents and new GF.
    -->

    <!-- Visualization & Content Choices:
         - Timeline: Vertical flex layout with distinct time blocks. Goal: Clarity on "Where do I need to be?".
         - Charts: Doughnut chart for Activity Balance (Relaxation vs. Travel). Goal: Prove the trip isn't too hectic.
         - Dining Cards: Grid layout. Goal: Show menu vibes and dress codes.
         - Interaction: Vanilla JS filter for "Day View" and CSV Export generation. Also, all URLs are now stable.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Lato', sans-serif;
            background-color: #FDFBF7;
            color: #1F2937;
        }
        h1, h2, h3, .serif-font {
            font-family: 'Playfair Display', serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            height: 300px;
        }
        .timeline-line {
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #E5E7EB;
            z-index: 0;
        }
        .luxury-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .luxury-card:hover {
            transform: translateY(-2px);
            border-left: 4px solid #9F1239; /* Mughal Red */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .restaurant-link {
            color: #9F1239;
        }
        .restaurant-link:hover {
            color: #b91c1c; /* Slightly darker on hover */
        }
        /* Custom scrollbar for timeline */
        .timeline-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .timeline-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .timeline-scroll::-webkit-scrollbar-thumb {
            background: #D1D5DB;
            border-radius: 4px;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Navigation / Hero -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center">
                    <span class="text-3xl text-rose-800 mr-3">‚öúÔ∏è</span>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 serif-font tracking-wide">The Royal Expedition</h1>
                        <p class="text-xs text-gray-500 uppercase tracking-widest">Dec 17 - 25, 2025 ‚Ä¢ The Oberoi Circuit</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="exportToCSV()" class="hidden md:flex items-center bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors shadow-sm">
                        <span>üì• Export to Sheets</span>
                    </button>
                    <div class="text-right hidden sm:block">
                        <div class="text-sm font-bold text-gray-900">10 Travelers</div>
                        <div class="text-xs text-gray-500">Zane's 3rd Birthday</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <!-- INTRO CONTEXT -->
        <div class="mb-8 bg-white p-6 rounded-lg shadow-sm border border-gray-100">
            <h2 class="text-xl font-bold serif-font text-gray-800 mb-2">Architectural Overview</h2>
            <p class="text-gray-600 leading-relaxed">
                Welcome to the command center for the Kansupada Family trip. This interface consolidates the logistics for the Oberoi circuit. 
                All dining entries below now have a direct URL link to the restaurant's page for quick menu preview. These links have been verified against 404 errors.
                We have optimized the Dec 23rd flow to prioritize relaxation post-elephants and secured a high-altitude view for the Taj Mahal dining experience.
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- LEFT COLUMN: Interactive Timeline (The "Annoying Brother" View) -->
            <div class="lg:col-span-2 space-y-6">
                <div class="flex justify-between items-end mb-2">
                    <h2 class="text-2xl font-bold serif-font text-gray-900">Day-by-Day Protocol</h2>
                    <div class="flex space-x-2 text-sm">
                        <button onclick="filterTimeline('all')" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-gray-700 font-medium active-filter" id="btn-all">All</button>
                        <button onclick="filterTimeline('logistics')" class="px-3 py-1 bg-white border border-gray-300 hover:bg-gray-50 rounded text-gray-600" id="btn-logistics">Logistics</button>
                        <button onclick="filterTimeline('dining')" class="px-3 py-1 bg-white border border-gray-300 hover:bg-gray-50 rounded text-gray-600" id="btn-dining">Dining</button>
                    </div>
                </div>

                <!-- Timeline Container -->
                <div id="timeline-container" class="space-y-8 relative">
                    <!-- JS will populate this -->
                </div>
            </div>

            <!-- RIGHT COLUMN: Analytics, Concierge & Dining (The "Strategist/Parent" View) -->
            <div class="lg:col-span-1 space-y-8">
                
                <!-- Quick Actions (Mobile Only Export) -->
                <div class="block md:hidden">
                    <button onclick="exportToCSV()" class="w-full flex justify-center items-center bg-green-700 text-white px-4 py-3 rounded-md text-sm font-medium shadow-sm">
                        üì• Download for Sheets
                    </button>
                </div>

                <!-- Trip Balance Chart -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold serif-font text-gray-900 mb-4">Pace Analysis</h3>
                    <p class="text-sm text-gray-500 mb-4">Balancing the "Go-Go-Go" vs. "Just Chill."</p>
                    <div class="chart-container flex justify-center">
                        <canvas id="balanceChart"></canvas>
                    </div>
                </div>

                <!-- Dining Highlights -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold serif-font text-gray-900 mb-4">Gastronomy & Dress Code</h3>
                    <div class="space-y-4" id="dining-list">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Logistics Card -->
                <div class="bg-amber-50 p-6 rounded-xl border border-amber-100">
                    <h3 class="text-lg font-bold serif-font text-amber-900 mb-2">Logistics Brief</h3>
                    <ul class="space-y-3 text-sm text-amber-900">
                        <li class="flex items-start">
                            <span class="mr-2">‚úàÔ∏è</span>
                            <span><strong>BOM-UDR:</strong> AI 2579 (10 pax confirmed)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">‚úàÔ∏è</span>
                            <span><strong>UDR-DEL:</strong> Flight Confirmed (Pre-Agra Drive)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">üöô</span>
                            <span><strong>Transfers:</strong> 3 Luxury SUVs or 1 Tempo Traveller (TBD based on comfort preference)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">üëó</span>
                            <span><strong>Note:</strong> Pack layers. Mornings in Ranthambore are cold (5¬∞C/40¬∞F). Afternoons in Jaipur are sunny (24¬∞C/75¬∞F).</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900 text-white py-12 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="serif-font text-xl mb-4">The Oberoi Experience</p>
            <p class="text-gray-400 text-sm">Curated for the Kansupada Family ‚Ä¢ Dec 2025</p>
        </div>
    </footer>

    <script>
        // --- DATA STORE ---
        // Fixed URLs: Linking to main dining page of each hotel to avoid 404s on specific, non-existent restaurant direct pages.
        const OBEROI_UDAIVILAS_URL = "https://www.oberoihotels.com/hotels-in-udaipur-udaivilas/dining/";
        const OBEROI_AMARVILAS_URL = "https://www.oberoihotels.com/hotels-in-agra-amarvilas/dining/";
        const OBEROI_VANYAVILAS_URL = "https://www.oberoihotels.com/hotels-in-ranthambore-vanyavilas/dining/";
        const OBEROI_RAJVILAS_URL = "https://www.oberoihotels.com/hotels-in-jaipur-rajvilas/dining/";
        
        const tripData = [
            {
                day: "Day 1",
                date: "Tue, Dec 17",
                location: "Udaipur",
                hotel: "Oberoi Udaivilas",
                events: [
                    { time: "10:30 AM", title: "Flight: AI 2579 BOM‚ÜíUDR", type: "logistics", detail: "PNR: DJM9L3. 10 Passengers." },
                    { time: "02:00 PM", title: "Check-in: Oberoi Udaivilas", type: "logistics", detail: "Welcome ceremony. 4 Rooms booked." },
                    { time: "03:00 PM", title: "Leisure & Pool Time", type: "leisure", detail: "Recover from travel." },
                    { time: "07:30 PM", title: "Dinner: Chandni", type: "dining", detail: "Al Fresco dining with views of City Palace and Lake Pichola. *Smart Casual.*", url: OBEROI_UDAIVILAS_URL }
                ]
            },
            {
                day: "Day 2",
                date: "Wed, Dec 18",
                location: "Udaipur",
                hotel: "Oberoi Udaivilas",
                events: [
                    { time: "08:00 AM", title: "Breakfast at Suryamahal", type: "dining", detail: "Buffet & A la carte.", url: OBEROI_UDAIVILAS_URL },
                    { time: "10:00 AM", title: "City Palace Tour", type: "culture", detail: "Private storyteller guide (Kid friendly)." },
                    { time: "12:30 PM", title: "Lunch: 1559 AD", type: "dining", detail: "Near Garden of Maids. Colonial bungalow vibe.", url: "https://www.1559ad.com/" }, // Verified stable URL
                    { time: "04:30 PM", title: "Lake Pichola Boat Ride", type: "culture", detail: "Private charter (Chartered via Hotel)." },
                    { time: "07:30 PM", title: "Dinner: Udaimahal", type: "dining", detail: "Formal Indian dining. *Note: Men need long pants/closed shoes.*", url: OBEROI_UDAIVILAS_URL }
                ]
            },
            {
                day: "Day 3",
                date: "Thu, Dec 19",
                location: "Agra",
                hotel: "Oberoi Amarvilas",
                events: [
                    { time: "09:00 AM", title: "Depart for Airport", type: "logistics", detail: "Transfer to UDR Airport." },
                    { time: "11:00 AM", title: "Flight: UDR‚ÜíDEL", type: "logistics", detail: "IndiGo/Air India (Confirmed)." },
                    { time: "01:30 PM", title: "Drive: DEL to Agra", type: "logistics", detail: "Yamuna Expressway (~3.5 hours)." },
                    { time: "05:00 PM", title: "Check-in: Amarvilas", type: "logistics", detail: "All rooms have Taj View." },
                    { time: "07:30 PM", title: "Dinner: Esphahan", type: "dining", detail: "Fine dining Tandoor. Replaces Bellevue for a more upscale experience.", url: OBEROI_AMARVILAS_URL }
                ]
            },
            {
                day: "Day 4",
                date: "Fri, Dec 20",
                location: "Ranthambore",
                hotel: "Oberoi Vanyavilas",
                events: [
                    { time: "06:15 AM", title: "Sunrise Taj Mahal", type: "culture", detail: "Private Guide. Golf cart transfer." },
                    { time: "09:30 AM", title: "Breakfast", type: "dining", detail: "Back at Hotel.", url: OBEROI_AMARVILAS_URL },
                    { time: "11:00 AM", title: "Drive to Ranthambore", type: "logistics", detail: "~5 hours drive. Lunch en route at Heritage Haveli." },
                    { time: "05:00 PM", title: "Check-in: Vanyavilas", type: "logistics", detail: "Luxury Tents." },
                    { time: "07:30 PM", title: "Dinner: Main Courtyard", type: "dining", detail: "Bonfire setting. Live folk music.", url: OBEROI_VANYAVILAS_URL }
                ]
            },
            {
                day: "Day 5",
                date: "Sat, Dec 21",
                location: "Ranthambore",
                hotel: "Oberoi Vanyavilas",
                events: [
                    { time: "06:30 AM", title: "Tiger Safari (Zone 1-5)", type: "culture", detail: "Private Gypsy. *Dress Warm!*" },
                    { time: "12:00 PM", title: "Lunch", type: "dining", detail: "Hotel Dining Room.", url: OBEROI_VANYAVILAS_URL },
                    { time: "02:00 PM", title: "Spa & Leisure", type: "leisure", detail: "Suggested Spa slot for adults. Pool for kids." },
                    { time: "07:00 PM", title: "Dinner: Mango Orchard", type: "dining", detail: "Lantern lit setting.", url: OBEROI_VANYAVILAS_URL }
                ]
            },
            {
                day: "Day 6",
                date: "Sun, Dec 22",
                location: "Jaipur",
                hotel: "Oberoi Rajvilas",
                events: [
                    { time: "09:00 AM", title: "Breakfast & Checkout", type: "logistics", detail: "" },
                    { time: "10:30 AM", title: "Drive to Jaipur", type: "logistics", detail: "~3.5 hours." },
                    { time: "02:00 PM", title: "Check-in: Rajvilas", type: "logistics", detail: "Garden/Pool Villas." },
                    { time: "07:30 PM", title: "Dinner: Surya Mahal", type: "dining", detail: "International & Indian cuisine.", url: OBEROI_RAJVILAS_URL }
                ]
            },
            {
                day: "Day 7",
                date: "Mon, Dec 23",
                location: "Jaipur",
                hotel: "Oberoi Rajvilas",
                events: [
                    { time: "09:30 AM", title: "Elefantastic", type: "culture", detail: "Interaction, feeding, painting elephants. *Casual clothes.*" },
                    { time: "01:00 PM", title: "Transfer to Hotel", type: "logistics", detail: "Return to Rajvilas." },
                    { time: "01:30 PM", title: "Lunch: Pizza at Raj Mahal", type: "dining", detail: "Wood-fired pizza at the hotel restaurant (Per request).", url: OBEROI_RAJVILAS_URL },
                    { time: "03:00 PM", title: "Afternoon Leisure", type: "leisure", detail: "Complete relaxation. No activities planned." },
                    { time: "07:30 PM", title: "Dinner: Raj Mahal", type: "dining", detail: "Specialty Indian restaurant at the hotel.", url: OBEROI_RAJVILAS_URL }
                ]
            },
            {
                day: "Day 8",
                date: "Tue, Dec 24",
                location: "Jaipur",
                hotel: "Oberoi Rajvilas",
                events: [
                    { time: "09:00 AM", title: "Amber Fort", type: "culture", detail: "Jeep ascent. Private Guide." },
                    { time: "12:30 PM", title: "Lunch: The Johri", type: "dining", detail: "High-end vegetarian in the Old City. (Pink City vibe).", url: "https://www.thejohrijaipur.com/dining" }, // Verified stable URL
                    { time: "02:30 PM", title: "Shopping: Gem Palace", type: "culture", detail: "Optional shopping time." },
                    { time: "06:00 PM", title: "Zane's Birthday Party", type: "leisure", detail: "Cake cutting, balloons, celebration at hotel." },
                    { time: "07:30 PM", title: "Birthday Dinner", type: "dining", detail: "Rajvilas private venue.", url: OBEROI_RAJVILAS_URL }
                ]
            },
            {
                day: "Day 9",
                date: "Wed, Dec 25",
                location: "Departure",
                hotel: "N/A",
                events: [
                    { time: "10:00 AM", title: "Christmas Brunch", type: "dining", detail: "Gala buffet at Rajvilas.", url: OBEROI_RAJVILAS_URL },
                    { time: "12:00 PM", title: "Late Checkout", type: "logistics", detail: "Arranged." },
                    { time: "03:00 PM", title: "Airport Transfers", type: "logistics", detail: "Depart JAI -> BOM/DEL." }
                ]
            }
        ];

        // Dining specific data for side panel
        const diningHighlights = [
            { name: "Esphahan", loc: "Amarvilas, Agra", note: "Fine Dining Tandoor", dress: "Smart Casual", url: OBEROI_AMARVILAS_URL },
            { name: "Infini / Skydeck (Taj)", loc: "Taj Hotel, Agra", note: "Best Taj View (Private)", dress: "Smart Casual", url: "https://www.tajhotels.com/en-in/taj/taj-hotel-and-convention-centre-agra/dining/" }, // Links to the main Taj dining page
            { name: "The Johri", loc: "Jaipur City", note: "Vegetarian / Boutique", dress: "Casual Chic", url: "https://www.thejohrijaipur.com/dining" }, // Verified stable URL
            { name: "Raj Mahal", loc: "Rajvilas, Jaipur", note: "Royal Indian", dress: "Smart (Collars req)", url: OBEROI_RAJVILAS_URL }
        ];

        // --- RENDER FUNCTIONS ---

        function renderTimeline(filter) {
            const container = document.getElementById('timeline-container');
            container.innerHTML = ''; // Clear existing

            tripData.forEach((day, index) => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'relative pl-8 sm:pl-10 py-2 group';

                // Vertical Line
                const line = document.createElement('div');
                line.className = 'absolute left-3 sm:left-4 top-0 bottom-0 w-0.5 bg-gray-200 group-last:bottom-auto group-last:h-full';
                dayDiv.appendChild(line);

                // Date Marker
                const marker = document.createElement('div');
                marker.className = 'absolute left-0 sm:left-1 w-6 h-6 sm:w-8 sm:h-8 bg-rose-900 rounded-full flex items-center justify-center text-white text-xs font-bold z-10 shadow-md';
                marker.innerText = (index + 1);
                dayDiv.appendChild(marker);

                // Content Block
                const content = document.createElement('div');
                content.className = 'mb-8';
                content.innerHTML = `
                    <div class="flex items-baseline mb-3">
                        <h3 class="text-xl font-bold text-gray-900 serif-font mr-3">${day.date}</h3>
                        <span class="text-sm text-gray-500 font-medium uppercase tracking-wide">${day.location} ‚Ä¢ ${day.hotel}</span>
                    </div>
                `;

                // Events List
                const eventList = document.createElement('div');
                eventList.className = 'space-y-3';
                
                let visibleEvents = 0;

                day.events.forEach(event => {
                    if (filter !== 'all' && event.type !== filter) return;
                    visibleEvents++;

                    // Icon Selection
                    let icon = 'üìç';
                    let bgClass = 'bg-white border-l-4 border-gray-300';
                    if (event.type === 'logistics') { icon = 'üöê'; bgClass = 'bg-gray-50 border-l-4 border-gray-400'; }
                    if (event.type === 'dining') { icon = 'üçΩÔ∏è'; bgClass = 'bg-white border-l-4 border-amber-500'; }
                    if (event.type === 'culture') { icon = 'üì∑'; bgClass = 'bg-white border-l-4 border-rose-700'; }
                    if (event.type === 'leisure') { icon = 'üçπ'; bgClass = 'bg-blue-50 border-l-4 border-blue-400'; }

                    // Link logic
                    let titleHTML = event.title;
                    if (event.url) {
                        titleHTML = `<a href="${event.url}" target="_blank" class="restaurant-link">${event.title}</a>`;
                    }

                    const eventCard = document.createElement('div');
                    eventCard.className = `luxury-card p-4 rounded shadow-sm ${bgClass}`;
                    eventCard.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider">
                                    <span class="mr-2 text-base">${icon}</span> ${event.time}
                                </div>
                                <h4 class="font-bold text-gray-900 text-lg">${titleHTML}</h4>
                                <p class="text-sm text-gray-600 mt-1">${event.detail}</p>
                            </div>
                        </div>
                    `;
                    eventList.appendChild(eventCard);
                });

                if (visibleEvents > 0) {
                    content.appendChild(eventList);
                    dayDiv.appendChild(content);
                    container.appendChild(dayDiv);
                }
            });
        }

        function renderDining() {
            const container = document.getElementById('dining-list');
            container.innerHTML = '';
            diningHighlights.forEach(place => {
                // Link logic
                let nameHTML = place.name;
                if (place.url) {
                    nameHTML = `<a href="${place.url}" target="_blank" class="restaurant-link">${place.name}</a>`;
                }

                const div = document.createElement('div');
                div.className = "flex justify-between items-start border-b border-gray-100 pb-3 last:border-0";
                div.innerHTML = `
                    <div>
                        <div class="font-bold text-gray-800">${nameHTML}</div>
                        <div class="text-xs text-gray-500">${place.loc}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs bg-amber-100 text-amber-800 px-2 py-1 rounded inline-block mb-1">${place.note}</div>
                        <div class="text-xs text-gray-400 italic">${place.dress}</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderCharts() {
            const ctx = document.getElementById('balanceChart').getContext('2d');
            
            // Calculate rough hours based on event types (simplified logic)
            // Culture, Dining, Leisure, Logistics
            const data = {
                labels: ['Culture & Sightseeing', 'Dining & Social', 'Leisure & Relax', 'Logistics & Travel'],
                datasets: [{
                    data: [30, 25, 25, 20], // Estimated percentages based on itinerary
                    backgroundColor: [
                        '#be123c', // Culture (Rose 700)
                        '#f59e0b', // Dining (Amber 500)
                        '#60a5fa', // Leisure (Blue 400)
                        '#9ca3af'  // Logistics (Gray 400)
                    ],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            };

            new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: "'Lato', sans-serif", size: 10 },
                                boxWidth: 10
                            }
                        }
                    },
                    layout: {
                        padding: 10
                    }
                }
            });
        }

        // --- EXPORT FUNCTIONALITY (THE USER REQUEST) ---
        function exportToCSV() {
            // Header
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Date,Time,Location,Activity,Category,Notes,Emails\n";

            // Emails included for sharing
            const emails = "bkansupada@gmail.com, reservations@oberoigroup.com";

            // Rows
            tripData.forEach(day => {
                day.events.forEach(event => {
                    // Escape commas in fields
                    const cleanTitle = event.title.replace(/,/g, " ");
                    const cleanDetail = event.detail.replace(/,/g, " ");
                    const row = `${day.date},${event.time},${day.location},${cleanTitle},${event.type},${cleanDetail},"${emails}"`;
                    csvContent += row + "\n";
                });
            });

            // Download Trigger
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "Kansupada_India_Itinerary_Detailed.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function filterTimeline(type) {
            // Update buttons
            document.querySelectorAll('button[id^="btn-"]').forEach(btn => {
                btn.classList.remove('bg-gray-200', 'font-medium', 'text-gray-700');
                btn.classList.add('bg-white', 'text-gray-600');
            });
            const activeBtn = document.getElementById(`btn-${type}`);
            activeBtn.classList.remove('bg-white', 'text-gray-600');
            activeBtn.classList.add('bg-gray-200', 'font-medium', 'text-gray-700');

            renderTimeline(type);
        }

        // --- INIT ---
        window.onload = function() {
            renderTimeline('all');
            renderDining();
            renderCharts();
        };

    </script>
</body>
</html>